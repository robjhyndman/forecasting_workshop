{
  "hash": "aca523d4bd7fe05400f20227379dc753",
  "result": {
    "markdown": "---\ntitle: \"Time Series Analysis & Forecasting Using R\"\nsubtitle: \"3. Transformations\"\n---\n\n\n## Outline\n\n\\vspace*{0.7cm}\\tableofcontents\n\n\n\n\n\n# Per capita adjustments\n\n## Per capita adjustments\n\n\n::: {.cell hash='3-transformations_cache/beamer/gdp-per-capita_c4151677a483fc7b6e0e23f4a8b9d6bf'}\n\n```{.r .cell-code}\nglobal_economy |>\n  filter(Country == \"Australia\") |>\n  autoplot(GDP)\n```\n\n::: {.cell-output-display}\n![](3-transformations_files/figure-beamer/gdp-per-capita-1.pdf)\n:::\n:::\n\n\n## Per capita adjustments\n\n\n::: {.cell hash='3-transformations_cache/beamer/gdp-per-capita2_a506323948e2f67a026aae813b311736'}\n\n```{.r .cell-code}\nglobal_economy |>\n  filter(Country == \"Australia\") |>\n  autoplot(GDP / Population)\n```\n\n::: {.cell-output-display}\n![](3-transformations_files/figure-beamer/gdp-per-capita2-1.pdf)\n:::\n:::\n\n\n# Lab Session 6\n## Lab Session 6\n\nConsider the GDP information in `global_economy`. Plot the GDP per capita for each country over time. Which country has the highest GDP per capita? How has this changed over time?\n\n# Inflation adjustments\n\n## Inflation adjustments\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='3-transformations_cache/beamer/unnamed-chunk-2_04a13b0b253e90d00a4736be5f85356b'}\n\n```{.r .cell-code}\nprint_retail <- aus_retail |>\n  filter(Industry == \"Newspaper and book retailing\") |>\n  group_by(Industry) |>\n  index_by(Year = year(Month)) |>\n  summarise(Turnover = sum(Turnover))\naus_economy <- filter(global_economy, Country == \"Australia\")\nprint_retail |>\n  left_join(aus_economy, by = \"Year\") |>\n  mutate(Adj_turnover = Turnover / CPI) |>\n  pivot_longer(c(Turnover, Adj_turnover),\n    names_to = \"Type\", values_to = \"Turnover\"\n  ) |>\n  ggplot(aes(x = Year, y = Turnover)) +\n  geom_line() +\n  facet_grid(vars(Type), scales = \"free_y\") +\n  labs(x = \"Years\", y = NULL,\n       title = \"Turnover: Australian print media industry\")\n```\n:::\n\n\n## Inflation adjustments\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='3-transformations_cache/beamer/unnamed-chunk-3_0edff8afc3d13ab75acd9fabc611aa27'}\n::: {.cell-output-display}\n![](3-transformations_files/figure-beamer/unnamed-chunk-3-1.pdf){height=90%}\n:::\n:::\n\n\n# Mathematical transformations\n\n## Variance stabilization\n\n\\fontsize{13}{15}\\sf\n\nIf the data show different variation at different levels of the series, then a transformation can be useful.\n\\pause\n\nDenote original observations as $y_1,\\dots,y_n$ and transformed\nobservations as $w_1, \\dots, w_n$.\n\\pause\n\n\\begin{block}{\\footnotesize Mathematical transformations for stabilizing\nvariation}\n\\begin{tabular}{llc}\nSquare root & $w_t = \\sqrt{y_t}$ & $\\downarrow$ \\\\[0.2cm]\nCube root & $w_t = \\sqrt[3]{y_t}$ & Increasing \\\\[0.2cm]\nLogarithm & $w_t = \\text{log}(y_t)$  & strength\n\\end{tabular}\n\\end{block}\n\\pause\n\nLogarithms, in particular, are useful because they are more interpretable: changes in a log value are **relative (percent) changes on the original scale**.\n\n## Variance stabilization\n\\fontsize{12}{14}\\sf\n\n\n::: {.cell hash='3-transformations_cache/beamer/food_87ba4037fa1487987c49d62ca7ca7e8f'}\n\n```{.r .cell-code}\nfood <- aus_retail |>\n  filter(Industry == \"Food retailing\") |>\n  summarise(Turnover = sum(Turnover))\n```\n:::\n\n::: {.cell hash='3-transformations_cache/beamer/food-plot_9c1e89e147eee7969f1834d576fc8ff8'}\n::: {.cell-output-display}\n![](3-transformations_files/figure-beamer/food-plot-1.pdf)\n:::\n:::\n\n\n## Variance stabilization\n\\fontsize{12}{14}\\sf\n\n\n::: {.cell hash='3-transformations_cache/beamer/food-sqrt1_dc39ff0dfd94608696dea2c14c3a75c4'}\n\n```{.r .cell-code}\nfood |> autoplot(sqrt(Turnover)) +\n  labs(y = \"Square root turnover\")\n```\n\n::: {.cell-output-display}\n![](3-transformations_files/figure-beamer/food-sqrt1-1.pdf)\n:::\n:::\n\n\n## Variance stabilization\n\\fontsize{12}{14}\\sf\n\n\n::: {.cell hash='3-transformations_cache/beamer/food-cbrt_e035137dd5af49867e767be12e873620'}\n\n```{.r .cell-code}\nfood |> autoplot(Turnover^(1 / 3)) +\n  labs(y = \"Cube root turnover\")\n```\n\n::: {.cell-output-display}\n![](3-transformations_files/figure-beamer/food-cbrt-1.pdf)\n:::\n:::\n\n\n## Variance stabilization\n\\fontsize{12}{14}\\sf\n\n\n::: {.cell hash='3-transformations_cache/beamer/food-log_f049779c4ee8a95a0b4dcfb7c0b190db'}\n\n```{.r .cell-code}\nfood |> autoplot(log(Turnover)) +\n  labs(y = \"Log turnover\")\n```\n\n::: {.cell-output-display}\n![](3-transformations_files/figure-beamer/food-log-1.pdf)\n:::\n:::\n\n\n## Variance stabilization\n\\fontsize{12}{14}\\sf\n\n\n::: {.cell hash='3-transformations_cache/beamer/food-inverse_a4b602298d9ede10cdbbc58c1cc3b2c8'}\n\n```{.r .cell-code}\nfood |> autoplot(-1 / Turnover) +\n  labs(y = \"Inverse turnover\")\n```\n\n::: {.cell-output-display}\n![](3-transformations_files/figure-beamer/food-inverse-1.pdf)\n:::\n:::\n\n\n## Box-Cox transformations\n\\fontsize{13}{15}\\sf\n\nEach of these transformations is close to a member of the\nfamily of \\textbf{Box-Cox transformations}:\n$$w_t = \\left\\{\\begin{array}{ll}\n        \\text{log}(y_t),      & \\quad \\lambda = 0; \\\\\n        (\\text{sign}(y_t)|y_t|^\\lambda-1)/\\lambda ,         & \\quad \\lambda \\ne 0.\n\\end{array}\\right.\n$$\\pause\\vspace*{-0.4cm}\n\n* Actually the Bickel-Doksum transformation (allowing for $y_t<0$)\n* $\\lambda=1$: (No substantive transformation)\n* $\\lambda=\\frac12$: (Square root plus linear transformation)\n* $\\lambda=0$: (Natural logarithm)\n* $\\lambda=-1$: (Inverse plus 1)\n\n## Box-Cox transformations\n\n\n::: {.cell hash='3-transformations_cache/beamer/food-anim_db07f2e5bad8b8efc0c0f36e8f243cda'}\n::: {.cell-output-display}\n```{=latex}\n\\animategraphics[,controls,buttonsize=0.3cm,width=11.5cm]{10}{3-transformations_files/figure-beamer/food-anim-}{1}{100}\n```\n:::\n:::\n\n\n## Box-Cox transformations\n\n\\fontsize{13}{15}\\sf\n\n\n::: {.cell hash='3-transformations_cache/beamer/food-lambda_37c9dbddffb53e7631398347cae322bf'}\n\n```{.r .cell-code}\nfood |>\n  features(Turnover, features = guerrero)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 x 1\n  lambda_guerrero\n            <dbl>\n1          0.0895\n```\n:::\n:::\n\n\n\\pause\n\n* This attempts to balance the seasonal fluctuations and random variation across the series.\n* Always check the results.\n* A low value of $\\lambda$ can give extremely large prediction intervals.\n\n## Box-Cox transformations\n\\fontsize{13}{14}\\sf\n\n\n::: {.cell hash='3-transformations_cache/beamer/food-bc_89a1b998a89f6915850bd97c2693e0a8'}\n\n```{.r .cell-code}\nfood |> autoplot(box_cox(Turnover, 0.0895)) +\n  labs(y = \"Box-Cox transformed turnover\")\n```\n\n::: {.cell-output-display}\n![](3-transformations_files/figure-beamer/food-bc-1.pdf)\n:::\n:::\n\n\n## Transformations\n\\fontsize{13}{15}\\sf\n\n* Often no transformation needed.\n* Simple transformations are easier to explain and work well enough.\n* Transformations can have very large effect on PI.\n* If some data are zero or negative, then use $\\lambda>0$.\n* `log1p()` can also be useful for data with zeros.\n* Choosing logs is a simple way to force forecasts to be positive\n* Transformations must be reversed to obtain forecasts on the original scale. (Handled automatically by `fable`.)\n\n# Lab Session 7\n\n## Lab Session 7\n\n\\fontsize{13}{14}\\sf\n\n1. For the following series, find an appropriate transformation in order to stabilise the variance.\n\n    * United States GDP from `global_economy`\n    * Slaughter of Victorian “Bulls, bullocks and steers” in `aus_livestock`\n    * Victorian Electricity Demand from `vic_elec`.\n    * Gas production from `aus_production`\n\n2. Why is a Box-Cox transformation unhelpful for the `canadian_gas` data?\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}