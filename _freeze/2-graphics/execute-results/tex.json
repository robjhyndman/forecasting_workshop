{
  "hash": "7094c0dba011128a49cdba9419288b32",
  "result": {
    "markdown": "---\ntitle: \"Time Series Analysis & Forecasting Using R\"\nsubtitle: \"2. Time series graphics\"\n---\n\n\n## Outline\n\n\\vspace*{0.7cm}\\tableofcontents\n\n\n\n\n\n# Seasonal plots\n\n## Seasonal plots\n\n  * Data plotted against the individual \"seasons\" in which the data were observed.  (In this case a \"season\" is a month.)\n  * Something like a time plot except that the data from each season are overlapped.\n  * Enables the underlying seasonal pattern to be seen more clearly, and also allows any substantial departures from the seasonal pattern to be easily identified.\n  * In R: `gg_season()`\n\n## Quarterly Australian Beer Production\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbeer <- aus_production |>\n  select(Quarter, Beer) |>\n  filter(year(Quarter) >= 1992)\nbeer |> autoplot(Beer)\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-2-1.pdf)\n:::\n:::\n\n\n## Quarterly Australian Beer Production\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbeer |> gg_season(Beer, labels = \"right\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-3-1.pdf)\n:::\n:::\n\n\n## Multiple seasonal periods\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_elec\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 52,608 x 5 [30m] <Australia/Melbourne>\n   Time                Demand Temperature Date       Holiday\n   <dttm>               <dbl>       <dbl> <date>     <lgl>  \n 1 2012-01-01 00:00:00  4383.        21.4 2012-01-01 TRUE   \n 2 2012-01-01 00:30:00  4263.        21.0 2012-01-01 TRUE   \n 3 2012-01-01 01:00:00  4049.        20.7 2012-01-01 TRUE   \n 4 2012-01-01 01:30:00  3878.        20.6 2012-01-01 TRUE   \n 5 2012-01-01 02:00:00  4036.        20.4 2012-01-01 TRUE   \n 6 2012-01-01 02:30:00  3866.        20.2 2012-01-01 TRUE   \n 7 2012-01-01 03:00:00  3694.        20.1 2012-01-01 TRUE   \n 8 2012-01-01 03:30:00  3562.        19.6 2012-01-01 TRUE   \n 9 2012-01-01 04:00:00  3433.        19.1 2012-01-01 TRUE   \n10 2012-01-01 04:30:00  3359.        19.0 2012-01-01 TRUE   \n# i 52,598 more rows\n```\n:::\n:::\n\n\n## Multiple seasonal periods\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_elec |> gg_season(Demand)\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-5-1.png)\n:::\n:::\n\n\n## Multiple seasonal periods\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_elec |> gg_season(Demand, period = \"week\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-6-1.png)\n:::\n:::\n\n\n## Multiple seasonal periods\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_elec |> gg_season(Demand, period = \"day\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-7-1.png)\n:::\n:::\n\n\n## Seasonal subseries plots\n\n  * Data for each season collected together in time plot as separate time series.\n  * Enables the underlying seasonal pattern to be seen clearly, and changes in seasonality over time to be visualized.\n  * In R: `gg_subseries()`\n\n## Quarterly Australian Beer Production\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbeer |> gg_subseries(Beer)\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-8-1.pdf)\n:::\n:::\n\n\n## Australian holidays\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nholidays <- tourism |>\n  filter(Purpose == \"Holiday\") |>\n  group_by(State) |>\n  summarise(Trips = sum(Trips))\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 640 x 3 [1Q]\n# Key:       State [8]\n   State Quarter Trips\n   <chr>   <qtr> <dbl>\n 1 ACT   1998 Q1  196.\n 2 ACT   1998 Q2  127.\n 3 ACT   1998 Q3  111.\n 4 ACT   1998 Q4  170.\n 5 ACT   1999 Q1  108.\n 6 ACT   1999 Q2  125.\n 7 ACT   1999 Q3  178.\n 8 ACT   1999 Q4  218.\n 9 ACT   2000 Q1  158.\n10 ACT   2000 Q2  155.\n# i 630 more rows\n```\n:::\n:::\n\n\n## Australian holidays\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nholidays |> autoplot(Trips) +\n  labs(y = \"thousands of trips\", title = \"Australian domestic holiday nights\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/holidays-plot-1.pdf)\n:::\n:::\n\n\n## Seasonal plots\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nholidays |> gg_season(Trips) +\n  labs(y = \"thousands of trips\", title = \"Australian domestic holiday nights\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/graphics1-1.pdf){width=42%}\n:::\n:::\n\n\n## Seasonal subseries plots\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nholidays |> gg_subseries(Trips) +\n  labs(y = \"thousands of trips\", title = \"Australian domestic holiday nights\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/graphics2-1.pdf){height=73%}\n:::\n:::\n\n\n## Calendar plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sugrrants)\nvic_elec |>\n  filter(year(Date) == 2014) |>\n  mutate(Hour = hour(Time)) |>\n  frame_calendar(x = Hour, y = Demand, date = Date, nrow = 4) |>\n  ggplot(aes(x = .Hour, y = .Demand, group = Date)) +\n  geom_line() -> p1\nprettify(p1,\n  size = 3,\n  label.padding = unit(0.15, \"lines\")\n)\n```\n:::\n\n\n* `frame_calendar()` makes a compact calendar plot\n* `facet_calendar()` provides an easier ggplot2 integration.\n\n## Calendar plots\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/sugrrants2-1.pdf){height=90%}\n:::\n:::\n\n\n# Lab Session 3\n## Lab Session 3\n\n1. Look at the quarterly tourism data for the Snowy Mountains\n\n    ```r\n    snowy <- tourism |>\n      filter(Region == \"Snowy Mountains\")\n    ```\n\n    - Use `autoplot()`, `gg_season()` and `gg_subseries()` to explore the data.\n    - What do you learn?\n\n2. Produce a calendar plot for the `pedestrian` data from one location and one year.\n\n# Seasonal or cyclic?\n\n## Time series patterns\n\nTrend\n  : pattern exists when there is a long-term increase or decrease in the data.\n\nSeasonal\n  : pattern exists when a series is influenced by seasonal factors (e.g., the quarter of the year, the month, or day of the week).\n\nCyclic\n  : pattern exists when data exhibit rises and falls that are \\emph{not of fixed period} (duration usually of at least 2 years).\n\n## Time series components\n\n### Differences between seasonal and cyclic patterns:\n\n* seasonal pattern constant length; cyclic pattern variable length\n* average length of cycle longer than length of seasonal pattern\n* magnitude of cycle more variable than magnitude of seasonal pattern\n\n## Time series patterns\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_production |>\n  filter(year(Quarter) >= 1980) |>\n  autoplot(Electricity) +\n  labs(y = \"GWh\", title = \"Australian electricity production\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-10-1.pdf)\n:::\n:::\n\n\n## Time series patterns\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_production |>\n  autoplot(Bricks) +\n  labs(title = \"Australian clay brick production\",\n       x = \"Year\", y = \"million units\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-11-1.pdf)\n:::\n:::\n\n\n## Time series patterns\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_employment |>\n  filter(Title == \"Retail Trade\", year(Month) >= 1980) |>\n  autoplot(Employed / 1e3) +\n  labs(title = \"Retail employment, USA\", y = \"Million people\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-12-1.pdf)\n:::\n:::\n\n\n## Time series patterns\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngafa_stock |>\n  filter(Symbol == \"AMZN\", year(Date) >= 2018) |>\n  autoplot(Close) +\n  labs(title = \"Amazon closing stock price\", x = \"Day\", y = \"$\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-13-1.pdf)\n:::\n:::\n\n\n## Time series patterns\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\npelt |>\n  autoplot(Lynx) +\n  labs(title = \"Annual Canadian Lynx Trappings\",\n       x = \"Year\", y = \"Number trapped\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-14-1.pdf)\n:::\n:::\n\n\n## Seasonal or cyclic?\n\n\\alert{Differences between seasonal and cyclic patterns:}\n\n  * seasonal pattern constant length; cyclic pattern variable length\n  * average length of cycle longer than length of seasonal pattern\n  * magnitude of cycle more variable than magnitude of seasonal pattern\n\n\\pause\n\n\\begin{alertblock}{}\nThe timing of peaks and troughs is predictable with seasonal data, but unpredictable in the long term with cyclic data.\n\\end{alertblock}\n\n# Lag plots and autocorrelation\n\n## Example: Beer production\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_production <- aus_production |>\n  filter(year(Quarter) >= 1992)\nnew_production\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 74 x 7 [1Q]\n   Quarter  Beer Tobacco Bricks Cement Electricity   Gas\n     <qtr> <dbl>   <dbl>  <dbl>  <dbl>       <dbl> <dbl>\n 1 1992 Q1   443    5777    383   1289       38332   117\n 2 1992 Q2   410    5853    404   1501       39774   151\n 3 1992 Q3   420    6416    446   1539       42246   175\n 4 1992 Q4   532    5825    420   1568       38498   129\n 5 1993 Q1   433    5724    394   1450       39460   116\n 6 1993 Q2   421    6036    462   1668       41356   149\n 7 1993 Q3   410    6570    475   1648       42949   163\n 8 1993 Q4   512    5675    443   1863       40974   138\n 9 1994 Q1   449    5311    421   1468       40162   127\n10 1994 Q2   381    5717    475   1755       41199   159\n# i 64 more rows\n```\n:::\n:::\n\n\n## Example: Beer production\n\\fontsize{13}{15}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_production |> gg_lag(Beer)\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-16-1.pdf){width=7cm}\n:::\n:::\n\n\n## Example: Beer production\n\\fontsize{13}{15}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_production |> gg_lag(Beer, geom = \"point\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-17-1.pdf){width=7cm}\n:::\n:::\n\n\n## Lagged scatterplots\n\n  * Each graph shows $y_t$ plotted against $y_{t-k}$ for\ndifferent values of $k$.\n  * The autocorrelations are the correlations associated\nwith these scatterplots.\n  * ACF (autocorrelation function):\n     * $r_1=\\text{Correlation}(y_{t}, y_{t-1})$\n     * $r_2=\\text{Correlation}(y_{t}, y_{t-2})$\n     * $r_3=\\text{Correlation}(y_{t}, y_{t-3})$\n     * etc.\n  * If there is **seasonality**, the ACF at the seasonal lag (e.g., 12 for monthly data) will be **large and positive**.\n\n## Autocorrelation\n\nResults for first 9 lags for beer data:\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_production |> ACF(Beer, lag_max = 9)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 9 x 2 [1Q]\n       lag     acf\n  <cf_lag>   <dbl>\n1       1Q -0.102 \n2       2Q -0.657 \n3       3Q -0.0603\n4       4Q  0.869 \n5       5Q -0.0892\n6       6Q -0.635 \n7       7Q -0.0542\n8       8Q  0.832 \n9       9Q -0.108 \n```\n:::\n:::\n\n\n## Autocorrelation\n\nResults for first 9 lags for beer data:\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_production |>\n  ACF(Beer, lag_max = 9) |>\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/beeracf-1.pdf)\n:::\n:::\n\n\n## ACF\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_production |>\n  ACF(Beer) |>\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-19-1.pdf)\n:::\n:::\n\n\n## Australian holidays\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nholidays |> ACF(Trips)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 152 x 3 [1Q]\n# Key:       State [8]\n   State      lag      acf\n   <chr> <cf_lag>    <dbl>\n 1 ACT         1Q  0.0877 \n 2 ACT         2Q  0.252  \n 3 ACT         3Q -0.0496 \n 4 ACT         4Q  0.300  \n 5 ACT         5Q -0.0741 \n 6 ACT         6Q  0.269  \n 7 ACT         7Q -0.00504\n 8 ACT         8Q  0.236  \n 9 ACT         9Q -0.0953 \n10 ACT        10Q  0.0750 \n# i 142 more rows\n```\n:::\n:::\n\n\n## Australian holidays\n\n\n::: {.cell}\n\n```{.r .cell-code}\nholidays |> ACF(Trips) |> autoplot()\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/tourismacf2-1.pdf){width=49%}\n:::\n:::\n\n\n## Trend and seasonality in ACF plots\n\n- When data have a trend, the autocorrelations for small lags tend to be large and positive.\n- When data are seasonal, the autocorrelations will be larger at the seasonal lags (i.e., at multiples of the seasonal frequency)\n- When data are trended and seasonal, you see a combination of these effects.\n\n## US retail trade employment\n\n\n::: {.cell}\n\n```{.r .cell-code}\nretail <- us_employment |>\n  filter(Title == \"Retail Trade\", year(Month) >= 1980)\nretail |> autoplot(Employed)\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-20-1.pdf)\n:::\n:::\n\n\n## US retail trade employment\n\n\n::: {.cell}\n\n```{.r .cell-code}\nretail |>\n  ACF(Employed, lag_max = 48) |>\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-21-1.pdf)\n:::\n:::\n\n\n## Google stock price\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngoogle_2015 <- gafa_stock |>\n  filter(Symbol == \"GOOG\", year(Date) == 2015) |>\n  select(Date, Close)\ngoogle_2015\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 252 x 2 [!]\n   Date       Close\n   <date>     <dbl>\n 1 2015-01-02  522.\n 2 2015-01-05  511.\n 3 2015-01-06  499.\n 4 2015-01-07  498.\n 5 2015-01-08  500.\n 6 2015-01-09  493.\n 7 2015-01-12  490.\n 8 2015-01-13  493.\n 9 2015-01-14  498.\n10 2015-01-15  499.\n# i 242 more rows\n```\n:::\n:::\n\n\n## Google stock price\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngoogle_2015 |> autoplot(Close)\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-22-1.pdf)\n:::\n:::\n\n\n## Google stock price\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngoogle_2015 |>\n  ACF(Close, lag_max = 100) |>\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-23-1.pdf)\n:::\n:::\n\n\n# Lab Session 4\n\n## Lab Session 4\n\nWe have introduced the following functions: `gg_lag` and `ACF`. Use these functions to explore the four time series: `Bricks` from `aus_production`, `Lynx` from `pelt`, `Close` price of Amazon from `gafa_stock`, `Demand` from `vic_elec`. Can you spot any seasonality, cyclicity and trend? What do you learn about the series?\n\n## Which is which?\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-24-1.pdf){width=100%}\n:::\n:::\n\n\n# White noise\n\n## Example: White noise\n\\fontsize{11}{13}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwn <- tsibble(t = seq(36), y = rnorm(36), index = t)\nwn |> autoplot(y)\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-25-1.pdf)\n:::\n:::\n\n\n\\only<2>{\n\\begin{textblock}{10}(1.4,6.7)\\fontsize{13}{15}\\sf\n\\begin{alertblock}{}\nWhite noise data is uncorrelated across time with zero mean and constant variance.\n\n(Technically, we require independence as well.)\n\\end{alertblock}\n\\end{textblock}}\n\n## Example: White noise\n\\fontsize{10}{10}\\sf\n\n```r\nwn |> ACF(y)\n```\n\n\\fontsize{10}{10}\\sf\\tabcolsep=0.1cm\n\n\n::: {.cell}\n::: {.cell-output-display}\n| $r_{1}$ | $r_{2}$ | $r_{3}$ | $r_{4}$ | $r_{5}$ | $r_{6}$ | $r_{7}$ | $r_{8}$ | $r_{9}$ | $r_{10}$ |\n|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|:--------:|\n|  0.011  | -0.044  |  0.039  | -0.273  |  0.113  | -0.172  |  0.056  |  0.106  | -0.156  |  0.144   |\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-26-1.pdf)\n:::\n:::\n\n\n\\pause\\fontsize{13}{15}\\sf\n\n * Sample autocorrelations for white noise series.\n * Expect each autocorrelation to be close to zero.\n * Blue lines show 95% critical values.\n\n## Example: Pigs slaughtered\n\n\\fontsize{11}{12}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\npigs <- aus_livestock |>\n  filter(State == \"Victoria\", Animal == \"Pigs\", year(Month) >= 2014)\npigs |> autoplot(Count / 1e3) +\n  labs(x = \"Year\", y = \"Thousands\",\n       title = \"Number of pigs slaughtered in Victoria\")\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-27-1.pdf)\n:::\n:::\n\n\n## Example: Pigs slaughtered\n\n\n::: {.cell}\n\n```{.r .cell-code}\npigs |>\n  ACF(Count) |>\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](2-graphics_files/figure-beamer/unnamed-chunk-28-1.pdf)\n:::\n:::\n\n\n## Example: Pigs slaughtered\n\nMonthly total number of pigs slaughtered\nin the state of Victoria, Australia, from January 2014 through December 2018\n(Source: Australian Bureau of Statistics.)\\pause\n\n  * Difficult to detect pattern in time plot.\n  * ACF shows significant autocorrelation for lag 2 and 12.\n  * Indicate some slight seasonality.\n\n\\pause\n\nThese show the series is **not a white noise series**.\n\n# Lab Session 5\n## Lab Session 5\n\nYou can compute the daily changes in the Google stock price in 2018 using\n\n\\fontsize{10.5}{13}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndgoog <- gafa_stock |>\n  filter(Symbol == \"GOOG\", year(Date) >= 2018) |>\n  mutate(diff = difference(Close))\n```\n:::\n\n\n\\fontsize{14}{16}\\sf\n\nDoes `diff` look like white noise?\n",
    "supporting": [
      "2-graphics_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}