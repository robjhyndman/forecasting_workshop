{
  "hash": "d017b485fdda76bde0a70b639553b002",
  "result": {
    "markdown": "---\ntitle: \"Time Series Analysis & Forecasting Using R\"\nsubtitle: \"9. Dynamic regression\"\n---\n\n\n## Outline\n\n\\vspace*{0.7cm}\\tableofcontents\n\n\n\n\n\n\n# Regression with ARIMA errors\n\n## Regression with ARIMA errors\n\\fontsize{13}{15}\\sf\n\n\\begin{block}{Regression models}\\vspace*{-0.2cm}\n\\[\n  y_t = \\beta_0 + \\beta_1 x_{1,t} + \\dots + \\beta_k x_{k,t} + \\varepsilon_t,\n\\]\n\\end{block}\\vspace*{-0.1cm}\n\n  * $y_t$ modeled as function of $k$ explanatory variables\n  * In regression, we assume that $\\varepsilon_t$ is white noise.\n\\vspace*{0.1cm}\n\\pause\n\\begin{alertblock}{RegARIMA model}\\vspace*{-0.7cm}\n\\begin{align*}\n  y_t &= \\beta_0 + \\beta_1 x_{1,t} + \\dots + \\beta_k x_{k,t} + \\eta_t,\\\\\n      \\eta_t &\\sim \\text{ARIMA}\n\\end{align*}\n\\end{alertblock}\n\n  * Residuals are from ARIMA model.\n  * Estimate model in one step using MLE\n  * Select model with lowest AICc value.\n\n## US personal consumption and income\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/usconsumpdata_ad8997a2f07be50cc974e7734f01a3bb'}\n\n```{.r .cell-code}\nus_change\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 198 x 6 [1Q]\n   Quarter Consumption Income Production Savings Unemployment\n     <qtr>       <dbl>  <dbl>      <dbl>   <dbl>        <dbl>\n 1 1970 Q1       0.619  1.04      -2.45    5.30         0.9  \n 2 1970 Q2       0.452  1.23      -0.551   7.79         0.5  \n 3 1970 Q3       0.873  1.59      -0.359   7.40         0.5  \n 4 1970 Q4      -0.272 -0.240     -2.19    1.17         0.700\n 5 1971 Q1       1.90   1.98       1.91    3.54        -0.100\n 6 1971 Q2       0.915  1.45       0.902   5.87        -0.100\n 7 1971 Q3       0.794  0.521      0.308  -0.406        0.100\n 8 1971 Q4       1.65   1.16       2.29   -1.49         0    \n 9 1972 Q1       1.31   0.457      4.15   -4.29        -0.200\n10 1972 Q2       1.89   1.03       1.89   -4.69        -0.100\n# i 188 more rows\n```\n:::\n:::\n\n\n## US personal consumption and income\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/usconsump_7564d7f2c451d853250ce6e2fa14b465'}\n\n```{.r .cell-code}\nus_change |>\n  pivot_longer(-Quarter, names_to = \"variable\", values_to = \"value\") |>\n  ggplot(aes(y = value, x = Quarter, group = variable)) +\n  geom_line() + facet_grid(variable ~ ., scales = \"free_y\") +\n  labs(x = \"Year\", y = \"\",\n       title = \"Quarterly changes in US consumption and personal income\")\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/usconsump-1.pdf){height=55%}\n:::\n:::\n\n\n## US personal consumption and income\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/usconsump_pairs_06dc2b0f8a3d02064d9022261aaab068'}\n\n```{.r .cell-code}\nus_change |> as_tibble() |> select(-Quarter) |> GGally::ggpairs()\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/usconsump_pairs-1.pdf){width=70%}\n:::\n:::\n\n\n## US personal consumption and income\n\n  * No need for transformations or further differencing.\n  *  Increase in income does not necessarily translate into instant increase in consumption (e.g., after the loss of a job, it may take a few months for expenses to be reduced to allow for the new circumstances). We will ignore this for now.\n\n## US personal consumption and income\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/usconsump2_c614c67b29fbbf91cc4f363987855c1c'}\n\n```{.r .cell-code}\nfit <- us_change |>\n  model(regarima = ARIMA(Consumption ~ Income + Production + Savings +\n                                                             Unemployment))\nreport(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSeries: Consumption \nModel: LM w/ ARIMA(0,1,2) errors \n\nCoefficients:\n          ma1     ma2  Income  Production  Savings  Unemployment\n      -1.0882  0.1118  0.7472      0.0370  -0.0531       -0.2096\ns.e.   0.0692  0.0676  0.0403      0.0229   0.0029        0.0986\n\nsigma^2 estimated as 0.09588:  log likelihood=-47.1\nAIC=108   AICc=109   BIC=131\n```\n:::\n:::\n\n\n\\fontsize{13}{14}\\sf\\pause\\begin{alertblock}{}\nWrite down the equations for the fitted model.\n\\end{alertblock}\n\n## US personal consumption and income\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-2_608bae7372b4f320408d3a1afe221c6e'}\n\n```{.r .cell-code}\ngg_tsresiduals(fit)\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/unnamed-chunk-2-1.pdf)\n:::\n:::\n\n\n## US personal consumption and income\n\\fontsize{11}{12}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-3_d132cfe0c5d0083ac3d52be40084a490'}\n\n```{.r .cell-code}\naugment(fit) |>\n  features(.resid, ljung_box, dof = 2, lag = 12)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 x 3\n  .model   lb_stat lb_pvalue\n  <chr>      <dbl>     <dbl>\n1 regarima    20.0    0.0290\n```\n:::\n:::\n\n\n## US personal consumption and income\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/usconsump3_ccac424cf5e9400252fee8182a8fc2b8'}\n\n```{.r .cell-code}\nus_change_future <- new_data(us_change, 8) |>\n  mutate(Income = tail(us_change$Income, 1),\n         Production = tail(us_change$Production, 1),\n         Savings = tail(us_change$Savings, 1),\n         Unemployment = tail(us_change$Unemployment, 1))\nforecast(fit, new_data = us_change_future) |>\n  autoplot(us_change) +\n  labs(x = \"Year\", y = \"Percentage change\",\n       title = \"Forecasts from dynamic regression\")\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/usconsump3-1.pdf)\n:::\n:::\n\n\n## Forecasting\n\n  * To forecast a regression model with ARIMA errors, we need to forecast the\nregression part of the model and the ARIMA part of the model and combine the\nresults.\n  * Some predictors are known into the future (e.g., time, dummies).\n  * Separate forecasting models may be needed for other predictors.\n  * Forecast intervals ignore the uncertainty in forecasting the predictors.\n\n## Daily electricity demand\n\\fontsize{12}{13}\\sf\n\nModel daily electricity demand as a function of temperature using quadratic regression with ARMA errors.\n\n\\fontsize{8}{9}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-4_36412a0ae0d6d6a24d3db4952d789ee8'}\n\n```{.r .cell-code}\nvic_elec_daily |>\n  ggplot(aes(x = Temperature, y = Demand, colour = Day_Type)) +\n  geom_point() +\n  labs(x = \"Maximum temperature\", y = \"Electricity demand (GW)\")\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/unnamed-chunk-4-1.pdf)\n:::\n:::\n\n\n## Daily electricity demand\n\\fontsize{8}{9}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-5_40a6a3ec3e21bfb13eab9b07a01d7379'}\n\n```{.r .cell-code}\nvic_elec_daily |>\n  pivot_longer(c(Demand, Temperature)) |>\n  ggplot(aes(x = Date, y = value)) +\n  geom_line() +\n  facet_grid(vars(name), scales = \"free_y\")\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/unnamed-chunk-5-1.pdf)\n:::\n:::\n\n\n## Daily electricity demand\n\\fontsize{8}{9}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/dailymodel_7affedd9e21fea2a2685b8f2733afba7'}\n\n```{.r .cell-code}\nfit <- vic_elec_daily |>\n  model(fit = ARIMA(Demand ~ Temperature + I(Temperature^2) +\n    (Day_Type == \"Weekday\")))\nreport(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSeries: Demand \nModel: LM w/ ARIMA(2,1,2)(2,0,0)[7] errors \n\nCoefficients:\n          ar1     ar2      ma1      ma2    sar1   sar2  Temperature  I(Temperature^2)\n      -0.1093  0.7226  -0.0182  -0.9381  0.1958  0.417       -7.614            0.1810\ns.e.   0.0779  0.0739   0.0494   0.0493  0.0525  0.057        0.448            0.0085\n      Day_Type == \"Weekday\"TRUE\n                          30.40\ns.e.                       1.33\n\nsigma^2 estimated as 44.91:  log likelihood=-1206\nAIC=2432   AICc=2433   BIC=2471\n```\n:::\n:::\n\n\n## Daily electricity demand\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-6_83b5a3815b05011e682283a1bb363c7f'}\n\n```{.r .cell-code}\naugment(fit) |>\n  gg_tsdisplay(.resid, plot_type = \"histogram\")\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/unnamed-chunk-6-1.pdf)\n:::\n:::\n\n\n## Daily electricity demand\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-7_5d612f2c6a9e92b515a47d7e4259e3d4'}\n\n```{.r .cell-code}\naugment(fit) |>\n  features(.resid, ljung_box, dof = 9, lag = 14)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 x 3\n  .model lb_stat lb_pvalue\n  <chr>    <dbl>     <dbl>\n1 fit       28.4 0.0000304\n```\n:::\n:::\n\n\n## Daily electricity demand\n\\fontsize{11}{12}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-8_c003ee1339324a5dc0691829a300bf22'}\n\n```{.r .cell-code}\n# Forecast one day ahead\nvic_next_day <- new_data(vic_elec_daily, 1) |>\n  mutate(Temperature = 26, Day_Type = \"Holiday\")\nforecast(fit, vic_next_day)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A fable: 1 x 6 [1D]\n# Key:     .model [1]\n  .model Date           Demand .mean Temperature Day_Type\n  <chr>  <date>         <dist> <dbl>       <dbl> <chr>   \n1 fit    2015-01-01 N(161, 45)  161.          26 Holiday \n```\n:::\n:::\n\n\n## Daily electricity demand\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-9_8042185b65faea9da0ee4d97c6400a6a'}\n\n```{.r .cell-code}\nvic_elec_future <- new_data(vic_elec_daily, 14) |>\n  mutate(\n    Temperature = 26,\n    Holiday = c(TRUE, rep(FALSE, 13)),\n    Day_Type = case_when(\n      Holiday ~ \"Holiday\",\n      wday(Date) %in% 2:6 ~ \"Weekday\",\n      TRUE ~ \"Weekend\"\n    )\n  )\n```\n:::\n\n\n## Daily electricity demand\n\\fontsize{8}{9}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-10_d1cf63304e0abb49627c0db32bed1792'}\n\n```{.r .cell-code}\nforecast(fit, vic_elec_future) |>\n  autoplot(vic_elec_daily) + labs(y = \"Electricity demand (GW)\")\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/unnamed-chunk-10-1.pdf)\n:::\n:::\n\n\n# Lab Session 18\n## Lab Session 18\n\\fontsize{11}{12}\\sf\n\nRepeat the daily electricity example, but instead of using a quadratic function of temperature, use a piecewise linear function with the \"knot\" around 20 degrees Celsius (use predictors `Temperature` & `Temp2`). How can you optimize the choice of knot?\n\n\\vspace*{-0.2cm}\\fontsize{8}{8.}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-11_47b57bc1b6207c6bae6bce22b2ece067'}\n\n```{.r .cell-code}\nvic_elec_daily <- vic_elec |>\n  filter(year(Time) == 2014) |>\n  index_by(Date = date(Time)) |>\n  summarise(Demand = sum(Demand) / 1e3,\n            Temperature = max(Temperature),\n            Holiday = any(Holiday)\n  ) |>\n  mutate(Temp2 = I(pmax(Temperature - 20, 0)),\n         Day_Type = case_when(\n           Holiday ~ \"Holiday\",\n           wday(Date) %in% 2:6 ~ \"Weekday\",\n           TRUE ~ \"Weekend\")\n  )\n```\n:::\n\n\n# Dynamic harmonic regression\n\n## Dynamic harmonic regression\n\n **Combine Fourier terms with ARIMA errors**\n\n\\fontsize{13}{14}\\sf\n\n### Advantages\n   * it allows any length seasonality;\n   * for data with more than one seasonal period, you can include Fourier terms of different frequencies;\n   * the seasonal pattern is smooth for small values of $K$ (but more wiggly seasonality can be handled by increasing $K$);\n   * the short-term dynamics are easily handled with a simple ARMA error.\n\n### Disadvantages\n * seasonality is assumed to be fixed\n\n## Eating-out expenditure\n\\fontsize{8}{9}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/cafe_70c5f0a34250801ee895269a72b72d18'}\n\n```{.r .cell-code}\naus_cafe <- aus_retail |>\n  filter(\n    Industry == \"Cafes, restaurants and takeaway food services\",\n    year(Month) %in% 2004:2018\n  ) |>\n  summarise(Turnover = sum(Turnover))\naus_cafe |> autoplot(Turnover)\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/cafe-1.pdf)\n:::\n:::\n\n\n## Eating-out expenditure\n\n\\fontsize{9}{9}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/cafefit_e802bc9d95ef9c521472b7a89e680f60'}\n\n```{.r .cell-code}\nfit <- aus_cafe |> model(\n  `K = 1` = ARIMA(log(Turnover) ~ fourier(K = 1) + PDQ(0, 0, 0)),\n  `K = 2` = ARIMA(log(Turnover) ~ fourier(K = 2) + PDQ(0, 0, 0)),\n  `K = 3` = ARIMA(log(Turnover) ~ fourier(K = 3) + PDQ(0, 0, 0)),\n  `K = 4` = ARIMA(log(Turnover) ~ fourier(K = 4) + PDQ(0, 0, 0)),\n  `K = 5` = ARIMA(log(Turnover) ~ fourier(K = 5) + PDQ(0, 0, 0)),\n  `K = 6` = ARIMA(log(Turnover) ~ fourier(K = 6) + PDQ(0, 0, 0))\n)\nglance(fit)\n```\n:::\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-12_c1c672e16d83fa4fcc76e43e094e91d8'}\n::: {.cell-output-display}\n|.model | sigma2| log_lik|  AIC| AICc|  BIC|\n|:------|------:|-------:|----:|----:|----:|\n|K = 1  |  0.002|     317| -616| -615| -588|\n|K = 2  |  0.001|     362| -700| -698| -661|\n|K = 3  |  0.001|     394| -763| -761| -725|\n|K = 4  |  0.001|     427| -822| -818| -771|\n|K = 5  |  0.000|     474| -919| -917| -875|\n|K = 6  |  0.000|     474| -920| -918| -875|\n:::\n:::\n\n\n## Eating-out expenditure\n\n\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/cafe1_0ae105a16185957e08d710365f2fd863'}\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/cafe1-1.pdf)\n:::\n:::\n\n\n## Eating-out expenditure\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/cafe2_af6503228430719a5cc1b71c23046d48'}\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/cafe2-1.pdf)\n:::\n:::\n\n\n## Eating-out expenditure\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/cafe3_d3c1203cbba433f6034094af33a2885c'}\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/cafe3-1.pdf)\n:::\n:::\n\n\n## Eating-out expenditure\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/cafe4_e9362e9568df2278664991a80ef3ec32'}\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/cafe4-1.pdf)\n:::\n:::\n\n\n## Eating-out expenditure\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/cafe5_c5adfefbbd61a64b3a1e44acdb30844e'}\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/cafe5-1.pdf)\n:::\n:::\n\n\n## Eating-out expenditure\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/cafe6_5751b3f4e1c97ff5cd2de44978f7787c'}\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/cafe6-1.pdf)\n:::\n:::\n\n\n## Example: weekly gasoline products\n\\fontsize{8}{8}\\sf\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-14_b4d190e4b99272802b38fd89008ad629'}\n\n:::\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/gasmodel_5fce13292d710073f8b9b551fe0dca39'}\n\n```{.r .cell-code}\nfit <- us_gasoline |> model(ARIMA(Barrels ~ fourier(K = 13) + PDQ(0, 0, 0)))\nreport(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSeries: Barrels \nModel: LM w/ ARIMA(0,1,1) errors \n\nCoefficients:\n          ma1  fourier(K = 13)C1_52  fourier(K = 13)S1_52\n      -0.8934               -0.1121               -0.2300\ns.e.   0.0132                0.0123                0.0122\n      fourier(K = 13)C2_52  fourier(K = 13)S2_52\n                    0.0420                0.0317\ns.e.                0.0099                0.0099\n      fourier(K = 13)C3_52  fourier(K = 13)S3_52\n                    0.0832                0.0346\ns.e.                0.0094                0.0094\n      fourier(K = 13)C4_52  fourier(K = 13)S4_52\n                    0.0185                0.0398\ns.e.                0.0092                0.0092\n      fourier(K = 13)C5_52  fourier(K = 13)S5_52\n                   -0.0315                0.0009\ns.e.                0.0091                0.0091\n      fourier(K = 13)C6_52  fourier(K = 13)S6_52\n                   -0.0522                 1e-04\ns.e.                0.0090                 9e-03\n      fourier(K = 13)C7_52  fourier(K = 13)S7_52\n                   -0.0173                0.0053\ns.e.                0.0090                0.0090\n      fourier(K = 13)C8_52  fourier(K = 13)S8_52\n                    0.0075                0.0048\ns.e.                0.0090                0.0090\n      fourier(K = 13)C9_52  fourier(K = 13)S9_52\n                   -0.0023               -0.0035\ns.e.                0.0090                0.0090\n      fourier(K = 13)C10_52  fourier(K = 13)S10_52\n                     0.0151                -0.0037\ns.e.                 0.0090                 0.0090\n      fourier(K = 13)C11_52  fourier(K = 13)S11_52\n                    -0.0144                 0.0191\ns.e.                 0.0090                 0.0090\n      fourier(K = 13)C12_52  fourier(K = 13)S12_52\n                    -0.0227                -0.0052\ns.e.                 0.0090                 0.0090\n      fourier(K = 13)C13_52  fourier(K = 13)S13_52  intercept\n                    -0.0035                 0.0037     0.0014\ns.e.                 0.0090                 0.0090     0.0007\n\nsigma^2 estimated as 0.06168:  log likelihood=-22\nAIC=102   AICc=103   BIC=253\n```\n:::\n:::\n\n\n## Example: weekly gasoline products\n\\fontsize{11}{12}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/gasf_464ad29087944e9d11c307c1dab7f786'}\n\n```{.r .cell-code}\nforecast(fit, h = \"3 years\") |>\n  autoplot(us_gasoline)\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/gasf-1.pdf)\n:::\n:::\n\n\n# Lab Session 19\n## Lab Session 19\n\nRepeat Lab Session 18 but using all available data, and handling the annual seasonality using Fourier terms.\n\n# Lagged predictors\n\n## Lagged predictors\n\nSometimes a change in $x_t$ does not affect $y_t$ instantaneously\n\n\\begin{block}{}\n\\begin{itemize}\n  \\item $y_t=$ sales, $x_t=$ advertising.\n  \\item $y_t=$ stream flow, $x_t=$ rainfall.\n  \\item $y_t=$ size of herd, $x_t=$ breeding stock.\n\\end{itemize}\n\\end{block}\n\\pause\n\n  * These are dynamic systems with input ($x_t$) and output $(y_t)$.\n  * $x_t$ is often a leading indicator.\n  * There can be multiple predictors.\n\n## Lagged predictors\n\nThe model include present and past values of predictor: $x_t,x_{t-1},x_{t-2},\\dots.$\n\\begin{block}{}\n\\centerline{$\ny_t = a + \\nu_0x_t + \\nu_1x_{t-1} + \\dots + \\nu_kx_{t-k} + \\eta_t$}\n\\end{block}\nwhere $\\eta_t$ is an ARIMA process.\\pause\n\n  * $x$ can influence $y$, but $y$ is not allowed to influence $x$.\n\n## Example: Insurance quotes and TV adverts\n\\fontsize{12}{12}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/tvadvertdata2_c85a085c57fb5ee275fad51085a95dbb'}\n\n```{.r .cell-code}\ninsurance\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 40 x 3 [1M]\n      Month Quotes TVadverts\n      <mth>  <dbl>     <dbl>\n 1 2002 Jan   13.0      7.21\n 2 2002 Feb   15.4      9.44\n 3 2002 Mar   13.2      7.53\n 4 2002 Apr   13.0      7.21\n 5 2002 May   15.4      9.44\n 6 2002 Jun   11.7      6.42\n 7 2002 Jul   10.1      5.81\n 8 2002 Aug   10.8      6.20\n 9 2002 Sep   13.3      7.59\n10 2002 Oct   14.6      8.00\n# i 30 more rows\n```\n:::\n:::\n\n\n## Example: Insurance quotes and TV adverts\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/tvadvert_d24dfd4773f34c1730f7e8c31181e549'}\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/tvadvert-1.pdf)\n:::\n:::\n\n\n## Example: Insurance quotes and TV adverts\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/tvadvertpairs_ce763cb73b3410cdbd79d7a77afeab2f'}\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/tvadvertpairs-1.pdf)\n:::\n:::\n\n\n## Example: Insurance quotes and TV adverts\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-15_f378c2b445ccf83b0ff5dc0f6478b5dd'}\n\n```{.r .cell-code}\nfit <- insurance |>\n  # Restrict data so models use same fitting period\n  mutate(Quotes = c(NA, NA, NA, Quotes[4:40])) |>\n  model(\n    ARIMA(Quotes ~ pdq(d = 0) + TVadverts),\n    ARIMA(Quotes ~ pdq(d = 0) + TVadverts +\n      lag(TVadverts)),\n    ARIMA(Quotes ~ pdq(d = 0) + TVadverts +\n      lag(TVadverts) +\n      lag(TVadverts, 2)),\n    ARIMA(Quotes ~ pdq(d = 0) + TVadverts +\n      lag(TVadverts) +\n      lag(TVadverts, 2) +\n      lag(TVadverts, 3))\n  )\n```\n:::\n\n\n## Example: Insurance quotes and TV adverts\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-16_7f83e5b3c6f91c696da981d8e6968cfc'}\n\n```{.r .cell-code}\nglance(fit)\n```\n:::\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-17_f8b68fb448adb73521bd85b556842eab'}\n::: {.cell-output-display}\n| Lag order| sigma2| log_lik|  AIC| AICc|  BIC|\n|---------:|------:|-------:|----:|----:|----:|\n|         0|  0.265|   -28.3| 66.6| 68.3| 75.0|\n|         1|  0.209|   -24.0| 58.1| 59.9| 66.5|\n|         2|  0.215|   -24.0| 60.0| 62.6| 70.2|\n|         3|  0.206|   -22.2| 60.3| 65.0| 73.8|\n:::\n:::\n\n\n## Example: Insurance quotes and TV adverts\n\n\\fontsize{8}{9}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/tvadvertagain_4f48baaee273917550455d4292710ae5'}\n\n```{.r .cell-code}\n# Re-fit to all data\nfit <- insurance |>\n  model(ARIMA(Quotes ~ TVadverts + lag(TVadverts) + pdq(d = 0)))\nreport(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSeries: Quotes \nModel: LM w/ ARIMA(1,0,2) errors \n\nCoefficients:\n        ar1    ma1    ma2  TVadverts  lag(TVadverts)  intercept\n      0.512  0.917  0.459     1.2527          0.1464       2.16\ns.e.  0.185  0.205  0.190     0.0588          0.0531       0.86\n\nsigma^2 estimated as 0.2166:  log likelihood=-23.9\nAIC=61.9   AICc=65.4   BIC=73.7\n```\n:::\n:::\n\n\n\\pause\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/tvadvertparam_c201e8eb4c6dace1640492c91901ed4c'}\n\n:::\n\n\n###\n\\fontsize{13}{13}\\sf\\vspace*{-0.7cm}\\begin{align*}\n  y_t &= 2.16 +\n         1.25 x_t +\n         0.15 x_{t-1} + \\eta_t,\\\\\n  \\eta_t &= 0.512 \\eta_{t-1} +\n        \\varepsilon_t +\n        0.92 \\varepsilon_{t-1} +\n        0.46 \\varepsilon_{t-2}.\n\\end{align*}\n\n## Example: Insurance quotes and TV adverts\n\\fontsize{11}{13}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-18_47ee84d090f839514fda2b1b46144230'}\n\n```{.r .cell-code}\nadvert_a <- new_data(insurance, 20) |>\n  mutate(TVadverts = 10)\nforecast(fit, advert_a) |> autoplot(insurance)\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/unnamed-chunk-18-1.pdf)\n:::\n:::\n\n\n## Example: Insurance quotes and TV adverts\n\\fontsize{11}{13}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-19_cc61df2fb9f4b22cfa45501c8a1639f9'}\n\n```{.r .cell-code}\nadvert_b <- new_data(insurance, 20) |>\n  mutate(TVadverts = 8)\nforecast(fit, advert_b) |> autoplot(insurance)\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/unnamed-chunk-19-1.pdf)\n:::\n:::\n\n\n## Example: Insurance quotes and TV adverts\n\\fontsize{11}{13}\\sf\n\n\n::: {.cell hash='9-dynamic-regression_cache/beamer/unnamed-chunk-20_4045321f51b2a8b99a0edc93db1e2804'}\n\n```{.r .cell-code}\nadvert_c <- new_data(insurance, 20) |>\n  mutate(TVadverts = 6)\nforecast(fit, advert_c) |> autoplot(insurance)\n```\n\n::: {.cell-output-display}\n![](9-dynamic-regression_files/figure-beamer/unnamed-chunk-20-1.pdf)\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}