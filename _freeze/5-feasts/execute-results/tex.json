{
  "hash": "26ae11190903c26deeddfbb124b6c05f",
  "result": {
    "markdown": "---\ntitle: \"Time Series Analysis & Forecasting Using R\"\nsubtitle: \"5. Time series features\"\n---\n\n\n## Outline\n\n\\vspace*{0.4cm}\\tableofcontents\n\n\n\n\n\n# STL Features\n\n## Strength of seasonality and trend\n\n\\begin{alertblock}{STL decomposition}\n\\centerline{$y_t = T_t+S_t+R_t$}\n\\end{alertblock}\n\n### Seasonal strength\n$$\\max\\left(0, 1-\\frac{\\text{Var}(R_t)}{\\text{Var}(S_t+R_t)}\\right)$$\n\n### Trend strength\n$$\\max\\left(0, 1-\\frac{\\text{Var}(R_t)}{\\text{Var}(T_t+R_t)}\\right)$$\n\n## Feature extraction and statistics\n\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell hash='5-feasts_cache/beamer/features_7ce870d6f43bf19c4de4f54de8e453ef'}\n\n```{.r .cell-code}\ntourism |> features(Trips, feat_stl)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 304 x 12\n   Region         State       Purpose trend_strength seasonal_strength_year\n   <chr>          <chr>       <chr>            <dbl>                  <dbl>\n 1 Adelaide       South Aust~ Busine~          0.464                  0.407\n 2 Adelaide       South Aust~ Holiday          0.554                  0.619\n 3 Adelaide       South Aust~ Other            0.746                  0.202\n 4 Adelaide       South Aust~ Visiti~          0.435                  0.452\n 5 Adelaide Hills South Aust~ Busine~          0.464                  0.179\n 6 Adelaide Hills South Aust~ Holiday          0.528                  0.296\n 7 Adelaide Hills South Aust~ Other            0.593                  0.404\n 8 Adelaide Hills South Aust~ Visiti~          0.488                  0.254\n 9 Alice Springs  Northern T~ Busine~          0.534                  0.251\n10 Alice Springs  Northern T~ Holiday          0.381                  0.832\n# i 294 more rows\n# i 7 more variables: seasonal_peak_year <dbl>,\n#   seasonal_trough_year <dbl>, spikiness <dbl>, linearity <dbl>,\n#   curvature <dbl>, stl_e_acf1 <dbl>, stl_e_acf10 <dbl>\n```\n:::\n:::\n\n\n## Feature extraction and statistics\n\\fontsize{8}{9}\\sf\n\n\n::: {.cell hash='5-feasts_cache/beamer/features-plot_5b82aaacf909938197967fe69f099f3b'}\n\n```{.r .cell-code}\ntourism |>\n  features(Trips, feat_stl) |>\n  ggplot(aes(x = trend_strength, y = seasonal_strength_year, col = Purpose)) +\n  geom_point() + facet_wrap(vars(State))\n```\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/features-plot-1.pdf)\n:::\n:::\n\n\n\\only<2->{\\begin{textblock}{4.7}(9.8,7)\n\\begin{alertblock}{}\\fontsize{10}{10}\\sf\n\\begin{itemize}\\tightlist\n\\item Holidays more seasonal than other travel.\n\\item WA has strongest trends.\n\\end{itemize}\n\\end{alertblock}\\end{textblock}}\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\nFind the most seasonal time series:\n\n\n::: {.cell hash='5-feasts_cache/beamer/extreme_3098e197945f1f887bf2d974a7c993dc'}\n\n```{.r .cell-code}\nmost_seasonal <- tourism |>\n  features(Trips, feat_stl) |>\n  filter(seasonal_strength_year == max(seasonal_strength_year))\n```\n:::\n\n\n\\pause\\vspace*{-0.3cm}\n\n\n::: {.cell hash='5-feasts_cache/beamer/extreme2_da4c796cf37b4f5b773253d299039dc6'}\n\n```{.r .cell-code}\ntourism |>\n  right_join(most_seasonal, by = c(\"State\", \"Region\", \"Purpose\")) |>\n  ggplot(aes(x = Quarter, y = Trips)) +\n  geom_line() + facet_grid(vars(State, Region, Purpose))\n```\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/extreme2-1.pdf)\n:::\n:::\n\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\nFind the most trended time series:\n\n\n::: {.cell hash='5-feasts_cache/beamer/extreme3_12440102420e8a84458e2f08df99ceb9'}\n\n```{.r .cell-code}\nmost_trended <- tourism |>\n  features(Trips, feat_stl) |>\n  filter(trend_strength == max(trend_strength))\n```\n:::\n\n\n\\pause\\vspace*{-0.3cm}\n\n\n::: {.cell hash='5-feasts_cache/beamer/extreme4_4d82a1e589b20cd078aa9acedcd68285'}\n\n```{.r .cell-code}\ntourism |>\n  right_join(most_trended, by = c(\"State\", \"Region\", \"Purpose\")) |>\n  ggplot(aes(x = Quarter, y = Trips)) +\n  geom_line() + facet_grid(vars(State, Region, Purpose))\n```\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/extreme4-1.pdf)\n:::\n:::\n\n\n# Lab Session 9\n\n## Lab Session 9\n\n * Use ``GGally::ggpairs()`` to look at the relationships between the STL-based features. You might wish to change `seasonal_peak_year` and `seasonal_trough_year` to factors.\n * Which is the peak quarter for holidays in each state?\n\n## Feature extraction and statistics\n\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell hash='5-feasts_cache/beamer/featuresacf_4702957f6bef5230a1d1e9bdf4d64baf'}\n\n```{.r .cell-code}\ntourism |> features(Trips, feat_acf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 304 x 10\n   Region    State Purpose     acf1 acf10 diff1_acf1 diff1_acf10 diff2_acf1\n   <chr>     <chr> <chr>      <dbl> <dbl>      <dbl>       <dbl>      <dbl>\n 1 Adelaide  Sout~ Busine~  0.0333  0.131     -0.520       0.463     -0.676\n 2 Adelaide  Sout~ Holiday  0.0456  0.372     -0.343       0.614     -0.487\n 3 Adelaide  Sout~ Other    0.517   1.15      -0.409       0.383     -0.675\n 4 Adelaide  Sout~ Visiti~  0.0684  0.294     -0.394       0.452     -0.518\n 5 Adelaide~ Sout~ Busine~  0.0709  0.134     -0.580       0.415     -0.750\n 6 Adelaide~ Sout~ Holiday  0.131   0.313     -0.536       0.500     -0.716\n 7 Adelaide~ Sout~ Other    0.261   0.330     -0.253       0.317     -0.457\n 8 Adelaide~ Sout~ Visiti~  0.139   0.117     -0.472       0.239     -0.626\n 9 Alice Sp~ Nort~ Busine~  0.217   0.367     -0.500       0.381     -0.658\n10 Alice Sp~ Nort~ Holiday -0.00660 2.11      -0.153       2.11      -0.274\n# i 294 more rows\n# i 2 more variables: diff2_acf10 <dbl>, season_acf1 <dbl>\n```\n:::\n:::\n\n\n# Dimension reduction for features\n\n\n::: {.cell hash='5-feasts_cache/beamer/pca_d4fed1185d9e078225633a5c74ab9433'}\n\n:::\n\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\n\n::: {.cell hash='5-feasts_cache/beamer/tourismfeatures_439e5bd4ffea84be6845fbe446bc6ebe'}\n\n```{.r .cell-code}\ntourism_features <- tourism |>\n  features(Trips, feature_set(pkgs = \"feasts\"))\n```\n:::\n\n::: {.cell hash='5-feasts_cache/beamer/unnamed-chunk-1_fa61810add721b81f1ae1e699da2cf8a'}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 304 x 51\n   Region         State       Purpose trend_strength seasonal_strength_year\n   <chr>          <chr>       <chr>            <dbl>                  <dbl>\n 1 Adelaide       South Aust~ Busine~          0.464                  0.407\n 2 Adelaide       South Aust~ Holiday          0.554                  0.619\n 3 Adelaide       South Aust~ Other            0.746                  0.202\n 4 Adelaide       South Aust~ Visiti~          0.435                  0.452\n 5 Adelaide Hills South Aust~ Busine~          0.464                  0.179\n 6 Adelaide Hills South Aust~ Holiday          0.528                  0.296\n 7 Adelaide Hills South Aust~ Other            0.593                  0.404\n 8 Adelaide Hills South Aust~ Visiti~          0.488                  0.254\n 9 Alice Springs  Northern T~ Busine~          0.534                  0.251\n10 Alice Springs  Northern T~ Holiday          0.381                  0.832\n# i 294 more rows\n# i 46 more variables: seasonal_peak_year <dbl>,\n#   seasonal_trough_year <dbl>, spikiness <dbl>, linearity <dbl>,\n#   curvature <dbl>, stl_e_acf1 <dbl>, stl_e_acf10 <dbl>, acf1 <dbl>,\n#   acf10 <dbl>, diff1_acf1 <dbl>, diff1_acf10 <dbl>, diff2_acf1 <dbl>,\n#   diff2_acf10 <dbl>, season_acf1 <dbl>, pacf5 <dbl>, diff1_pacf5 <dbl>,\n#   diff2_pacf5 <dbl>, season_pacf <dbl>, zero_run_mean <dbl>, ...\n```\n:::\n:::\n\n\n\\begin{textblock}{4.5}(10.6,1.3)\n\\begin{alertblock}{}\\fontsize{10}{12}\\sf\nAll features from the feasts package\n\\end{alertblock}\n\\end{textblock}\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\n\n::: {.cell hash='5-feasts_cache/beamer/pcatable_d1b77b03124627eeb801e74792f11213'}\n\n```{.r .cell-code}\npcs <- tourism_features |>\n  select(-State, -Region, -Purpose) |>\n  prcomp(scale = TRUE) |>\n  broom::augment(tourism_features)\n```\n:::\n\n::: {.cell hash='5-feasts_cache/beamer/unnamed-chunk-2_4e666068f2bdcb9dda90bb2effc6240e'}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 304 x 100\n   .rownames Region     State Purpose trend_strength seasonal_strength_year\n   <chr>     <chr>      <chr> <chr>            <dbl>                  <dbl>\n 1 1         Adelaide   Sout~ Busine~          0.464                  0.407\n 2 2         Adelaide   Sout~ Holiday          0.554                  0.619\n 3 3         Adelaide   Sout~ Other            0.746                  0.202\n 4 4         Adelaide   Sout~ Visiti~          0.435                  0.452\n 5 5         Adelaide ~ Sout~ Busine~          0.464                  0.179\n 6 6         Adelaide ~ Sout~ Holiday          0.528                  0.296\n 7 7         Adelaide ~ Sout~ Other            0.593                  0.404\n 8 8         Adelaide ~ Sout~ Visiti~          0.488                  0.254\n 9 9         Alice Spr~ Nort~ Busine~          0.534                  0.251\n10 10        Alice Spr~ Nort~ Holiday          0.381                  0.832\n# i 294 more rows\n# i 94 more variables: seasonal_peak_year <dbl>,\n#   seasonal_trough_year <dbl>, spikiness <dbl>, linearity <dbl>,\n#   curvature <dbl>, stl_e_acf1 <dbl>, stl_e_acf10 <dbl>, acf1 <dbl>,\n#   acf10 <dbl>, diff1_acf1 <dbl>, diff1_acf10 <dbl>, diff2_acf1 <dbl>,\n#   diff2_acf10 <dbl>, season_acf1 <dbl>, pacf5 <dbl>, diff1_pacf5 <dbl>,\n#   diff2_pacf5 <dbl>, season_pacf <dbl>, zero_run_mean <dbl>, ...\n```\n:::\n:::\n\n\n\\begin{textblock}{4.5}(9.6,1.5)\n\\begin{alertblock}{}\\fontsize{10}{12}\\sf\nPrincipal components based on all features from the feasts package\n\\end{alertblock}\n\\end{textblock}\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\n\\begin{textblock}{3.3}(.4,3)\n\\begin{alertblock}{}\\fontsize{10}{12}\\sf\nPrincipal components based on all features from the feasts package\n\\end{alertblock}\n\\end{textblock}\n\n```r\npcs |> ggplot(aes(x=.fittedPC1, y=.fittedPC2)) +\n  geom_point() + theme(aspect.ratio=1)\n```\n\n\\placefig{4}{2.6}{height=6.4cm, width=12cm}{pca1}\n\\vspace*{10cm}\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\n\\begin{textblock}{3.3}(.4,3)\n\\begin{alertblock}{}\\fontsize{10}{12}\\sf\nPrincipal components based on all features from the feasts package\n\\end{alertblock}\n\\end{textblock}\n\n```r\npcs |> ggplot(aes(x=.fittedPC1, y=.fittedPC2, col=State)) +\n  geom_point() + theme(aspect.ratio=1)\n```\n\n\\placefig{4}{2.6}{height=6.4cm, width=12cm}{pca2}\n\\vspace*{10cm}\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\n\\begin{textblock}{3.3}(.4,3)\n\\begin{alertblock}{}\\fontsize{10}{12}\\sf\nPrincipal components based on all features from the feasts package\n\\end{alertblock}\n\\end{textblock}\n\n```r\npcs |> ggplot(aes(x=.fittedPC1, y=.fittedPC2, col=Purpose)) +\n  geom_point() + theme(aspect.ratio=1)\n```\n\n\\only<1>{\\placefig{4}{2.6}{height=6.4cm, width=12cm}{pca3}}\n\\only<2>{\\placefig{4}{2.6}{height=6.4cm, width=12cm}{pca4}}\n\\vspace*{10cm}\n\n## Feature extraction and statistics\n\\fontsize{8}{8}\\sf\n\n\n::: {.cell hash='5-feasts_cache/beamer/outliers2_57643f57ce19ec65c1e1b331b875041d'}\n\n```{.r .cell-code}\noutliers |>\n  left_join(tourism, by = c(\"State\", \"Region\", \"Purpose\")) |>\n  mutate(Series = glue(\"{State}\", \"{Region}\", \"{Purpose}\", .sep = \"\\n\\n\")) |>\n  ggplot(aes(x = Quarter, y = Trips)) +\n  geom_line() + facet_grid(Series ~ .) +\n  labs(title = \"Outlying time series in PC space\")\n```\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/outliers2-1.pdf){height=55%}\n:::\n:::\n\n\n# Lab Session 10\n\n## Lab Session 10\n\n* Use a feature-based approach to look for outlying series in `PBS`.\n\n* What is unusual about the series you identify as outliers?\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}