{
  "hash": "7d3ce9dbc2e543479790662db96f383d",
  "result": {
    "markdown": "---\ntitle: \"Time Series Analysis & Forecasting Using R\"\nsubtitle: \"5. Time series features\"\n---\n\n\n## Outline\n\n\\vspace*{0.7cm}\\tableofcontents\n\n\n\n\n\n# STL Features\n\n## Strength of seasonality and trend\n\n\\begin{alertblock}{STL decomposition}\n\\centerline{$y_t = T_t+S_t+R_t$}\n\\end{alertblock}\n\n### Seasonal strength\n$$\\max\\left(0, 1-\\frac{\\text{Var}(R_t)}{\\text{Var}(S_t+R_t)}\\right)$$\n\n### Trend strength\n$$\\max\\left(0, 1-\\frac{\\text{Var}(R_t)}{\\text{Var}(T_t+R_t)}\\right)$$\n\n## Feature extraction and statistics\n\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism |> features(Trips, feat_stl)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 304 x 12\n   Region         State Purpose trend_strength seasonal_strength_year seasonal_peak_year\n   <chr>          <chr> <chr>            <dbl>                  <dbl>              <dbl>\n 1 Adelaide       SA    Busine~          0.464                  0.407                  3\n 2 Adelaide       SA    Holiday          0.554                  0.619                  1\n 3 Adelaide       SA    Other            0.746                  0.202                  2\n 4 Adelaide       SA    Visiti~          0.435                  0.452                  1\n 5 Adelaide Hills SA    Busine~          0.464                  0.179                  3\n 6 Adelaide Hills SA    Holiday          0.528                  0.296                  2\n 7 Adelaide Hills SA    Other            0.593                  0.404                  2\n 8 Adelaide Hills SA    Visiti~          0.488                  0.254                  0\n 9 Alice Springs  NT    Busine~          0.534                  0.251                  0\n10 Alice Springs  NT    Holiday          0.381                  0.832                  3\n# i 294 more rows\n# i 6 more variables: seasonal_trough_year <dbl>, spikiness <dbl>, linearity <dbl>,\n#   curvature <dbl>, stl_e_acf1 <dbl>, stl_e_acf10 <dbl>\n```\n:::\n:::\n\n\n## Feature extraction and statistics\n\\fontsize{8}{9}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism |>\n  features(Trips, feat_stl) |>\n  ggplot(aes(x = trend_strength, y = seasonal_strength_year, col = Purpose)) +\n  geom_point() + facet_wrap(vars(State))\n```\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/features-plot-1.pdf)\n:::\n:::\n\n\n\\only<2->{\\begin{textblock}{4.7}(9.8,7)\n\\begin{alertblock}{}\\fontsize{10}{10}\\sf\n\\begin{itemize}\\tightlist\n\\item Holidays more seasonal than other travel.\n\\item WA has strongest trends.\n\\end{itemize}\n\\end{alertblock}\\end{textblock}}\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\nFind the most seasonal time series:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmost_seasonal <- tourism |>\n  features(Trips, feat_stl) |>\n  filter(seasonal_strength_year == max(seasonal_strength_year))\n```\n:::\n\n\n\\pause\\vspace*{-0.3cm}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism |>\n  right_join(most_seasonal, by = c(\"State\", \"Region\", \"Purpose\")) |>\n  ggplot(aes(x = Quarter, y = Trips)) +\n  geom_line() + facet_grid(vars(State, Region, Purpose))\n```\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/extreme2-1.pdf)\n:::\n:::\n\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\nFind the most trended time series:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmost_trended <- tourism |>\n  features(Trips, feat_stl) |>\n  filter(trend_strength == max(trend_strength))\n```\n:::\n\n\n\\pause\\vspace*{-0.3cm}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism |>\n  right_join(most_trended, by = c(\"State\", \"Region\", \"Purpose\")) |>\n  ggplot(aes(x = Quarter, y = Trips)) +\n  geom_line() + facet_grid(vars(State, Region, Purpose))\n```\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/extreme4-1.pdf)\n:::\n:::\n\n\n# Lab Session 9\n\n## Lab Session 9\n\n * Use ``GGally::ggpairs()`` to look at the relationships between the STL-based features. You might wish to change `seasonal_peak_year` and `seasonal_trough_year` to factors.\n * Which is the peak quarter for holidays in each state?\n\n## Feature extraction and statistics\n\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism |> features(Trips, feat_acf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 304 x 10\n   Region     State Purpose     acf1 acf10 diff1_acf1 diff1_acf10 diff2_acf1 diff2_acf10\n   <chr>      <chr> <chr>      <dbl> <dbl>      <dbl>       <dbl>      <dbl>       <dbl>\n 1 Adelaide   SA    Busine~  0.0333  0.131     -0.520       0.463     -0.676       0.741\n 2 Adelaide   SA    Holiday  0.0456  0.372     -0.343       0.614     -0.487       0.558\n 3 Adelaide   SA    Other    0.517   1.15      -0.409       0.383     -0.675       0.792\n 4 Adelaide   SA    Visiti~  0.0684  0.294     -0.394       0.452     -0.518       0.447\n 5 Adelaide ~ SA    Busine~  0.0709  0.134     -0.580       0.415     -0.750       0.746\n 6 Adelaide ~ SA    Holiday  0.131   0.313     -0.536       0.500     -0.716       0.906\n 7 Adelaide ~ SA    Other    0.261   0.330     -0.253       0.317     -0.457       0.392\n 8 Adelaide ~ SA    Visiti~  0.139   0.117     -0.472       0.239     -0.626       0.408\n 9 Alice Spr~ NT    Busine~  0.217   0.367     -0.500       0.381     -0.658       0.587\n10 Alice Spr~ NT    Holiday -0.00660 2.11      -0.153       2.11      -0.274       1.55 \n# i 294 more rows\n# i 1 more variable: season_acf1 <dbl>\n```\n:::\n:::\n\n\n# Dimension reduction for features\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/pca-1.pdf)\n:::\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/pca-2.pdf)\n:::\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/pca-3.pdf)\n:::\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/pca-4.pdf)\n:::\n:::\n\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism_features <- tourism |>\n  features(Trips, feature_set(pkgs = \"feasts\"))\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 304 x 51\n   Region         State Purpose trend_strength seasonal_strength_year seasonal_peak_year\n   <chr>          <chr> <chr>            <dbl>                  <dbl>              <dbl>\n 1 Adelaide       SA    Busine~          0.464                  0.407                  3\n 2 Adelaide       SA    Holiday          0.554                  0.619                  1\n 3 Adelaide       SA    Other            0.746                  0.202                  2\n 4 Adelaide       SA    Visiti~          0.435                  0.452                  1\n 5 Adelaide Hills SA    Busine~          0.464                  0.179                  3\n 6 Adelaide Hills SA    Holiday          0.528                  0.296                  2\n 7 Adelaide Hills SA    Other            0.593                  0.404                  2\n 8 Adelaide Hills SA    Visiti~          0.488                  0.254                  0\n 9 Alice Springs  NT    Busine~          0.534                  0.251                  0\n10 Alice Springs  NT    Holiday          0.381                  0.832                  3\n# i 294 more rows\n# i 45 more variables: seasonal_trough_year <dbl>, spikiness <dbl>, linearity <dbl>,\n#   curvature <dbl>, stl_e_acf1 <dbl>, stl_e_acf10 <dbl>, acf1 <dbl>, acf10 <dbl>,\n#   diff1_acf1 <dbl>, diff1_acf10 <dbl>, diff2_acf1 <dbl>, diff2_acf10 <dbl>,\n#   season_acf1 <dbl>, pacf5 <dbl>, diff1_pacf5 <dbl>, diff2_pacf5 <dbl>,\n#   season_pacf <dbl>, zero_run_mean <dbl>, nonzero_squared_cv <dbl>,\n#   zero_start_prop <dbl>, zero_end_prop <dbl>, lambda_guerrero <dbl>, ...\n```\n:::\n:::\n\n\n\\begin{textblock}{4.5}(10.6,1.3)\n\\begin{alertblock}{}\\fontsize{10}{12}\\sf\nAll features from the feasts package\n\\end{alertblock}\n\\end{textblock}\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\npcs <- tourism_features |>\n  select(-State, -Region, -Purpose) |>\n  prcomp(scale = TRUE) |>\n  broom::augment(tourism_features)\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 304 x 100\n   .rownames Region         State Purpose  trend_strength seasonal_strength_year\n   <chr>     <chr>          <chr> <chr>             <dbl>                  <dbl>\n 1 1         Adelaide       SA    Business          0.464                  0.407\n 2 2         Adelaide       SA    Holiday           0.554                  0.619\n 3 3         Adelaide       SA    Other             0.746                  0.202\n 4 4         Adelaide       SA    Visiting          0.435                  0.452\n 5 5         Adelaide Hills SA    Business          0.464                  0.179\n 6 6         Adelaide Hills SA    Holiday           0.528                  0.296\n 7 7         Adelaide Hills SA    Other             0.593                  0.404\n 8 8         Adelaide Hills SA    Visiting          0.488                  0.254\n 9 9         Alice Springs  NT    Business          0.534                  0.251\n10 10        Alice Springs  NT    Holiday           0.381                  0.832\n# i 294 more rows\n# i 94 more variables: seasonal_peak_year <dbl>, seasonal_trough_year <dbl>,\n#   spikiness <dbl>, linearity <dbl>, curvature <dbl>, stl_e_acf1 <dbl>,\n#   stl_e_acf10 <dbl>, acf1 <dbl>, acf10 <dbl>, diff1_acf1 <dbl>, diff1_acf10 <dbl>,\n#   diff2_acf1 <dbl>, diff2_acf10 <dbl>, season_acf1 <dbl>, pacf5 <dbl>,\n#   diff1_pacf5 <dbl>, diff2_pacf5 <dbl>, season_pacf <dbl>, zero_run_mean <dbl>,\n#   nonzero_squared_cv <dbl>, zero_start_prop <dbl>, zero_end_prop <dbl>, ...\n```\n:::\n:::\n\n\n\\begin{textblock}{4.5}(9.6,1.5)\n\\begin{alertblock}{}\\fontsize{10}{12}\\sf\nPrincipal components based on all features from the feasts package\n\\end{alertblock}\n\\end{textblock}\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\n\\begin{textblock}{3.3}(.4,3)\n\\begin{alertblock}{}\\fontsize{10}{12}\\sf\nPrincipal components based on all features from the feasts package\n\\end{alertblock}\n\\end{textblock}\n\n```r\npcs |> ggplot(aes(x=.fittedPC1, y=.fittedPC2)) +\n  geom_point() + theme(aspect.ratio=1)\n```\n\n\\placefig{4}{2.6}{height=6.4cm, width=12cm}{pca1}\n\\vspace*{10cm}\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\n\\begin{textblock}{3.3}(.4,3)\n\\begin{alertblock}{}\\fontsize{10}{12}\\sf\nPrincipal components based on all features from the feasts package\n\\end{alertblock}\n\\end{textblock}\n\n```r\npcs |> ggplot(aes(x=.fittedPC1, y=.fittedPC2, col=State)) +\n  geom_point() + theme(aspect.ratio=1)\n```\n\n\\placefig{4}{2.6}{height=6.4cm, width=12cm}{pca2}\n\\vspace*{10cm}\n\n## Feature extraction and statistics\n\\fontsize{9}{9}\\sf\n\n\\begin{textblock}{3.3}(.4,3)\n\\begin{alertblock}{}\\fontsize{10}{12}\\sf\nPrincipal components based on all features from the feasts package\n\\end{alertblock}\n\\end{textblock}\n\n```r\npcs |> ggplot(aes(x=.fittedPC1, y=.fittedPC2, col=Purpose)) +\n  geom_point() + theme(aspect.ratio=1)\n```\n\n\\only<1>{\\placefig{4}{2.6}{height=6.4cm, width=12cm}{pca3}}\n\\only<2>{\\placefig{4}{2.6}{height=6.4cm, width=12cm}{pca4}}\n\\vspace*{10cm}\n\n## Feature extraction and statistics\n\\fontsize{8}{8}\\sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutliers |>\n  left_join(tourism, by = c(\"State\", \"Region\", \"Purpose\")) |>\n  mutate(Series = glue(\"{State}\", \"{Region}\", \"{Purpose}\", .sep = \"\\n\\n\")) |>\n  ggplot(aes(x = Quarter, y = Trips)) +\n  geom_line() + facet_grid(Series ~ .) +\n  labs(title = \"Outlying time series in PC space\")\n```\n\n::: {.cell-output-display}\n![](5-feasts_files/figure-beamer/outliers2-1.pdf){height=55%}\n:::\n:::\n\n\n# Lab Session 10\n\n## Lab Session 10\n\n* Use a feature-based approach to look for outlying series in `PBS`.\n\n* What is unusual about the series you identify as outliers?\n",
    "supporting": [
      "5-feasts_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}