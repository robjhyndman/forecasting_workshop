{
  "hash": "7d8168ab0ed694ea29e1c709b25bebc1",
  "result": {
    "markdown": "---\ntitle: \"Time Series Analysis & Forecasting Using R\"\nsubtitle: \"6. Introduction to forecasting\"\npdf-engine: pdflatex\nfig-width: 7.5\nfig-height: 3\nformat:\n  beamer:\n    theme: monash\n    aspectratio: 169\n    fontsize: 14pt\n    section-titles: false\n    knitr:\n      opts_chunk:\n        dev: \"CairoPDF\"\ninclude-in-header: header.tex\nkeep-tex: true\ntoc: false\nexecute:\n  echo: false\n  message: false\n  warning: false\n  cache: true\n---\n\n\n## Outline\n\n\\vspace*{0.4cm}\\tableofcontents\n\n\n\n\n\n# Statistical forecasting\n\n## Forecasting is difficult\n\n\\full{hopecasts2}\n\n## What can we forecast?\n\n\\full{nasdaq-stock-market}\n\n## What can we forecast?\n\n\\full{Forex2}\n\n## What can we forecast?\n\n\\full{pills}\n\n## What can we forecast?\n\n\\full{elecwires2}\n\n## What can we forecast?\n\n\\full{AusBOM}\n\n## What can we forecast?\n\n\\full{ts22015}\n\n## What can we forecast?\n\n\\full{comet}\n\n## Which is easiest to forecast?\n\n 1. daily electricity demand in 3 days time\n 2. timing of next Halley's comet appearance\n 3. time of sunrise this day next year\n 4. Google stock price tomorrow\n 5. Google stock price in 6 months time\n 6. maximum temperature tomorrow\n 7. exchange rate of \\$US/AUS next week\n 8. total sales of drugs in Australian pharmacies next month\n\n\\pause\n\n - how do we measure \"easiest\"?\n - what makes something easy/difficult to forecast?\n\n## Factors affecting forecastability\n\nSomething is easier to forecast if:\n\n - we have a good understanding of the factors that contribute to it\n - there is lots of data available;\n - the forecasts cannot affect the thing we are trying to forecast.\n - there is relatively low natural/unexplainable random variation.\n - the future is somewhat similar to the past\n\n## Random futures\n\n\n::: {.cell hash='6-fable_cache/beamer/austa_6ed9373d05d2b65843f1664178015ac4'}\n\n:::\n\n\n\\forecast\\pause\n\n\n::: {.cell hash='6-fable_cache/beamer/austa1_5fb25c812f08850a31c175a48f06d43d'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/austa1-1.pdf)\n:::\n:::\n\n\n## Random futures\n\n\\forecast\n\n\n::: {.cell hash='6-fable_cache/beamer/austa2_5cbdffe8e60f784068e6c3c73479e1dd'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/austa2-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## Random futures\n\n\\forecast\n\n\n::: {.cell hash='6-fable_cache/beamer/austa3_b2a73a65023c12921395ea6cd9852791'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/austa3-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## Random futures\n\n\\forecast\n\n\n::: {.cell hash='6-fable_cache/beamer/austa4_420f819d6f5c23edd79f8a32d8a638bd'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/austa4-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## Random futures\n\n\\forecast\n\n\n::: {.cell hash='6-fable_cache/beamer/austa5_f1394ef24bcd3da41a736b93742e02fc'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/austa5-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## Random futures\n\n\\forecast\n\n\n::: {.cell hash='6-fable_cache/beamer/austa6_84430726cfb2548c87a15281b15f6749'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/austa6-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## Random futures\n\n\\forecast\n\n\n::: {.cell hash='6-fable_cache/beamer/austa7_2d135cc7edaef4605e02fa2265dd8c4d'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/austa7-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## Random futures\n\n\\forecast\n\n\n::: {.cell hash='6-fable_cache/beamer/austa8_dd703d18af92e727d09799879821d5ea'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/austa8-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## Random futures\n\n\\forecast\n\n\n::: {.cell hash='6-fable_cache/beamer/austa9_889377d73409585d14835be5a4fc8df7'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/austa9-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## Random futures\n\n\\forecast\n\n\n::: {.cell hash='6-fable_cache/beamer/austa9b_4f42967bc9993814749cd617b7aa1287'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/austa9b-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n\\only<2>{\\begin{textblock}{8.5}(.3,6.5)\\begin{alertblock}{}\n``He who sees the past as surprise-free is bound to have a future full of surprises.''\\\\\\mbox{}\\hfill{\\small (Amos Tversky)}\n\\end{alertblock}\\end{textblock}\n}\n\n## Statistical forecasting\n\n- Thing to be forecast: $y_{T+h}$.\n- What we know: $y_1,\\dots,y_T$.\n- Forecast distribution: ${y}_{T+h|t} = y_{T+h} \\mid \\{y_1,y_2,\\dots,y_{T}\\}$.\n- Point forecast: $\\hat{y}_{T+h|T} =\\text{E}[y_{T+h} \\mid y_1,\\dots,y_T]$.\n- Forecast variance: $\\text{Var}[y_{t}  \\mid y_1,\\dots,y_T]$\n- Prediction interval is a range of values of $y_{T+h}$ with high probability.\n\n# Benchmark methods\n\n## Some simple forecasting methods\n\n\n::: {.cell hash='6-fable_cache/beamer/ausbeer_4b25c273016f9993576b7a8d57073f93'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/ausbeer-1.pdf)\n:::\n:::\n\n\n\\begin{textblock}{7}(0.2,8.7)\n\\begin{alertblock}{}\n\\small{How would you forecast these series?}\n\\end{alertblock}\n\\end{textblock}\n\n## Some simple forecasting methods\n\n\n::: {.cell hash='6-fable_cache/beamer/pigs_cab96bd5237259bb751e4130f6d4b8b2'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/pigs-1.pdf)\n:::\n:::\n\n\n\\begin{textblock}{7}(0.2,8.7)\n\\begin{alertblock}{}\n\\small{How would you forecast these series?}\n\\end{alertblock}\n\\end{textblock}\n\n## Some simple forecasting methods\n\n\n::: {.cell hash='6-fable_cache/beamer/dj_cb01d791cefcb132b148aaf5794a0643'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/dj-1.pdf)\n:::\n:::\n\n\n\\begin{textblock}{7}(0.2,8.7)\n\\begin{alertblock}{}\n\\small{How would you forecast these series?}\n\\end{alertblock}\n\\end{textblock}\n\n## Some simple forecasting methods\n\\fontsize{13}{14}\\sf\n\n### `MEAN(y)`: Average method\n\n  * Forecast of all future values is equal to mean of historical data $\\{y_1,\\dots,y_T\\}$.\n  * Forecasts: $\\hat{y}_{T+h|T} = \\bar{y} = (y_1+\\dots+y_T)/T$\n\n\n::: {.cell hash='6-fable_cache/beamer/mean-method-explained_ec9f48d075b17d9e545c32032ed91b4f'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/mean-method-explained-1.pdf)\n:::\n:::\n\n\n## Some simple forecasting methods\n\\fontsize{13}{14}\\sf\n\n### `NAIVE(y)`: Naïve method\n\n  * Forecasts equal to last observed value.\n  * Forecasts: $\\hat{y}_{T+h|T} =y_T$.\n  * Consequence of efficient market hypothesis.\n\n\n::: {.cell hash='6-fable_cache/beamer/naive-method-explained_f181a6479fd855a8b241e2a8b01eff2b'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/naive-method-explained-1.pdf)\n:::\n:::\n\n\n## Some simple forecasting methods\n\\fontsize{13}{14}\\sf\n\n### `SNAIVE(y ~ lag(m))`: Seasonal naïve method\n\n  * Forecasts equal to last value from same season.\n  * Forecasts: $\\hat{y}_{T+h|T} =y_{T+h-m(k+1)}$, where $m=$ seasonal period and $k$ is the integer part of $(h-1)/m$.\n\n\n::: {.cell hash='6-fable_cache/beamer/snaive-method-explained_ebeb18e93523debb7b93085a687a66e7'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/snaive-method-explained-1.pdf)\n:::\n:::\n\n\n## Some simple forecasting methods\n\\fontsize{13}{14}\\sf\n\n### `RW(y ~ drift())`: Drift method\n\n * Forecasts equal to last value plus average change.\n * Forecasts:\\vspace*{-.7cm}\n\n \\begin{align*}\n \\hat{y}_{T+h|T} & =  y_{T} + \\frac{h}{T-1}\\sum_{t=2}^T (y_t-y_{t-1})\\\\\n                 & = y_T + \\frac{h}{T-1}(y_T -y_1).\n \\end{align*}\\vspace*{-0.2cm}\n\n   * Equivalent to extrapolating a line drawn between first and last observations.\n\n## Some simple forecasting methods\n\n### Drift method\n\n\n::: {.cell hash='6-fable_cache/beamer/drift-method-explained_ebfb9d87062ec0b7ad4fb8e22963cf16'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/drift-method-explained-1.pdf)\n:::\n:::\n\n\n## Model fitting\n\nThe `model()` function trains models to data.\n\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/brick-model_ca0a894fbcc7aa101f769e0a25d412ec'}\n\n```{.r .cell-code}\nbrick_fit <- aus_production |>\n  filter(!is.na(Bricks)) |>\n  model(\n    `Seasonal_naïve` = SNAIVE(Bricks),\n    `Naïve` = NAIVE(Bricks),\n    Drift = RW(Bricks ~ drift()),\n    Mean = MEAN(Bricks)\n  )\n```\n:::\n\n::: {.cell hash='6-fable_cache/beamer/brick-model2_29cbcf82b6f9807649777aa44c024a81'}\n::: {.cell-output .cell-output-stdout}\n```\n# A mable: 1 x 4\n  Seasonal_naïve   Naïve         Drift    Mean\n         <model> <model>       <model> <model>\n1       <SNAIVE> <NAIVE> <RW w/ drift>  <MEAN>\n```\n:::\n:::\n\n\n\\vspace*{-0.2cm}\\begin{alertblock}{}\nA \\texttt{mable} is a model table, each cell corresponds to a fitted model.\n\\end{alertblock}\n\n## Producing forecasts\n\n\\fontsize{10}{13}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/brick-fc_47e8aa8ab98d150021095a462395412e'}\n\n```{.r .cell-code}\nbrick_fc <- brick_fit |>\n  forecast(h = \"5 years\")\n```\n:::\n\n::: {.cell hash='6-fable_cache/beamer/brick-fbl_eb8fa25ed7db342ffb7e2310ae30498d'}\n::: {.cell-output .cell-output-stdout}\n```\n# A fable: 80 x 4 [1Q]\n# Key:     .model [4]\n  .model         Quarter       Bricks .mean\n  <chr>            <qtr>       <dist> <dbl>\n1 Seasonal_naïve 2005 Q3 N(428, 2336)   428\n2 Seasonal_naïve 2005 Q4 N(397, 2336)   397\n3 Seasonal_naïve 2006 Q1 N(355, 2336)   355\n4 Seasonal_naïve 2006 Q2 N(435, 2336)   435\n# i 76 more rows\n```\n:::\n:::\n\n\n\\begin{alertblock}{}\nA \\texttt{fable} is a forecast table with point forecasts and distributions.\n\\end{alertblock}\n\n## Visualising forecasts\n\n\\footnotesize\n\n\n::: {.cell hash='6-fable_cache/beamer/brick-fc-plot_3307a750c13e9dfbbfebabcd390f00cc'}\n\n```{.r .cell-code}\nbrick_fc |>\n  autoplot(aus_production, level = NULL) +\n  labs(title = \"Forecasts for quarterly clay brick production\",\n       x = \"Year\", y = \"Millions of bricks\") +\n  guides(colour = guide_legend(title = \"Forecast\"))\n```\n\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/brick-fc-plot-1.pdf)\n:::\n:::\n\n\n## Prediction intervals\n\\fontsize{10}{12}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/brick-fc-interval_96cb9827e6e619f71e07c104c0f585c9'}\n\n```{.r .cell-code}\nbrick_fc |> hilo(level = c(50, 75))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 80 x 6 [1Q]\n# Key:       .model [4]\n   .model         Quarter       Bricks .mean        `50%`        `75%`\n   <chr>            <qtr>       <dist> <dbl>       <hilo>       <hilo>\n 1 Seasonal_naïve 2005 Q3 N(428, 2336)   428 [395, 461]50 [372, 484]75\n 2 Seasonal_naïve 2005 Q4 N(397, 2336)   397 [364, 430]50 [341, 453]75\n 3 Seasonal_naïve 2006 Q1 N(355, 2336)   355 [322, 388]50 [299, 411]75\n 4 Seasonal_naïve 2006 Q2 N(435, 2336)   435 [402, 468]50 [379, 491]75\n 5 Seasonal_naïve 2006 Q3 N(428, 4672)   428 [382, 474]50 [349, 507]75\n 6 Seasonal_naïve 2006 Q4 N(397, 4672)   397 [351, 443]50 [318, 476]75\n 7 Seasonal_naïve 2007 Q1 N(355, 4672)   355 [309, 401]50 [276, 434]75\n 8 Seasonal_naïve 2007 Q2 N(435, 4672)   435 [389, 481]50 [356, 514]75\n 9 Seasonal_naïve 2007 Q3 N(428, 7008)   428 [372, 484]50 [332, 524]75\n10 Seasonal_naïve 2007 Q4 N(397, 7008)   397 [341, 453]50 [301, 493]75\n# i 70 more rows\n```\n:::\n:::\n\n\n## Prediction intervals\n\\fontsize{10}{12}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/brick-fc-interval2_41fd810803751b8c63111a63965c2d3f'}\n\n```{.r .cell-code}\nbrick_fc |>\n  hilo(level = c(50, 75)) |>\n  unpack_hilo(c(\"50%\", \"75%\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 80 x 8 [1Q]\n# Key:       .model [4]\n   .model    Quarter       Bricks .mean `50%_lower` `50%_upper` `75%_lower`\n   <chr>       <qtr>       <dist> <dbl>       <dbl>       <dbl>       <dbl>\n 1 Seasonal~ 2005 Q3 N(428, 2336)   428        395.        461.        372.\n 2 Seasonal~ 2005 Q4 N(397, 2336)   397        364.        430.        341.\n 3 Seasonal~ 2006 Q1 N(355, 2336)   355        322.        388.        299.\n 4 Seasonal~ 2006 Q2 N(435, 2336)   435        402.        468.        379.\n 5 Seasonal~ 2006 Q3 N(428, 4672)   428        382.        474.        349.\n 6 Seasonal~ 2006 Q4 N(397, 4672)   397        351.        443.        318.\n 7 Seasonal~ 2007 Q1 N(355, 4672)   355        309.        401.        276.\n 8 Seasonal~ 2007 Q2 N(435, 4672)   435        389.        481.        356.\n 9 Seasonal~ 2007 Q3 N(428, 7008)   428        372.        484.        332.\n10 Seasonal~ 2007 Q4 N(397, 7008)   397        341.        453.        301.\n# i 70 more rows\n# i 1 more variable: `75%_upper` <dbl>\n```\n:::\n:::\n\n\n# Lab Session 11\n## Lab Session 11\n\n * Produce forecasts using an appropriate benchmark method for household wealth (`hh_budget`). Plot the results using `autoplot()`.\n * Produce forecasts using an appropriate benchmark method for Australian takeaway food turnover (`aus_retail`). Plot the results using `autoplot()`.\n\n# Residual diagnostics\n\n## Fitted values\n\n - $\\hat{y}_{t|t-1}$ is the forecast of $y_t$ based on observations $y_1,\\dots,y_t$.\n - We call these \"fitted values\".\n - Sometimes drop the subscript: $\\hat{y}_t \\equiv \\hat{y}_{t|t-1}$.\n - Often not true forecasts since parameters are estimated on all data.\n\n### For example:\n\n - $\\hat{y}_{t} = \\bar{y}$ for average method.\n - $\\hat{y}_{t} = y_{t-1} + (y_{T}-y_1)/(T-1)$ for drift method.\n\n## Forecasting residuals\n\n\\begin{block}{}\n\\textbf{Residuals in forecasting:} difference between observed value and its fitted value: $e_t = y_t-\\hat{y}_{t|t-1}$.\n\\end{block}\n\\pause\\fontsize{13}{15}\\sf\n\n\\alert{Assumptions}\n\n  1. $\\{e_t\\}$ uncorrelated. If they aren't, then information left in  residuals that should be used in computing forecasts.\n  2. $\\{e_t\\}$ have mean zero. If they don't, then forecasts are biased.\n\n\\pause\n\n\\alert{Useful properties} (for prediction intervals)\n\n  3. $\\{e_t\\}$ have constant variance.\n  4. $\\{e_t\\}$ are normally distributed.\n\n## Facebook closing stock price\n\\fontsize{9}{10}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/fbf_e64d3ffa618754cfec7a2fcbc0aac113'}\n\n```{.r .cell-code}\nfb_stock <- gafa_stock |>\n  filter(Symbol == \"FB\")\nfb_stock |> autoplot(Close)\n```\n\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/fbf-1.pdf)\n:::\n:::\n\n\n## Facebook closing stock price\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/augment_a599a9ead7d730dcbd6c9bc657bece50'}\n\n```{.r .cell-code}\nfb_stock <- fb_stock |>\n  mutate(trading_day = row_number()) |>\n  update_tsibble(index = trading_day, regular = TRUE)\nfit <- fb_stock |> model(NAIVE(Close))\naugment(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 1,258 x 7 [1]\n# Key:       Symbol, .model [1]\n   Symbol .model       trading_day Close .fitted .resid .innov\n   <chr>  <chr>              <int> <dbl>   <dbl>  <dbl>  <dbl>\n 1 FB     NAIVE(Close)           1  54.7    NA   NA     NA    \n 2 FB     NAIVE(Close)           2  54.6    54.7 -0.150 -0.150\n 3 FB     NAIVE(Close)           3  57.2    54.6  2.64   2.64 \n 4 FB     NAIVE(Close)           4  57.9    57.2  0.720  0.720\n 5 FB     NAIVE(Close)           5  58.2    57.9  0.310  0.310\n 6 FB     NAIVE(Close)           6  57.2    58.2 -1.01  -1.01 \n 7 FB     NAIVE(Close)           7  57.9    57.2  0.720  0.720\n 8 FB     NAIVE(Close)           8  55.9    57.9 -2.03  -2.03 \n 9 FB     NAIVE(Close)           9  57.7    55.9  1.83   1.83 \n10 FB     NAIVE(Close)          10  57.6    57.7 -0.140 -0.140\n# i 1,248 more rows\n```\n:::\n:::\n\n\n## Facebook closing stock price\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/dj4_24a1a23d18ac21cd9a221926a60b21d2'}\n\n```{.r .cell-code}\naugment(fit) |>\n  ggplot(aes(x = trading_day)) +\n  geom_line(aes(y = Close, colour = \"Data\")) +\n  geom_line(aes(y = .fitted, colour = \"Fitted\"))\n```\n\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/dj4-1.pdf)\n:::\n:::\n\n\n## Facebook closing stock price\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/dj4a_58ee9c530581e64abfd1731ba68aab2c'}\n\n```{.r .cell-code}\naugment(fit) |>\n  filter(trading_day > 1100) |>\n  ggplot(aes(x = trading_day)) +\n  geom_line(aes(y = Close, colour = \"Data\")) +\n  geom_line(aes(y = .fitted, colour = \"Fitted\"))\n```\n\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/dj4a-1.pdf)\n:::\n:::\n\n\n## Facebook closing stock price\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/dj5_e4129e75610e5664dbeff2a24eecc7a2'}\n\n```{.r .cell-code}\naugment(fit) |>\n  autoplot(.resid) +\n  labs(x = \"Day\", y = \"\", title = \"Residuals from naïve method\")\n```\n\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/dj5-1.pdf)\n:::\n:::\n\n\n## Facebook closing stock price\n\\fontsize{11}{11}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/dj6_b942f9e6516de24299280cac26d62bff'}\n\n```{.r .cell-code}\naugment(fit) |>\n  ggplot(aes(x = .resid)) +\n  geom_histogram(bins = 150) +\n  labs(title = \"Histogram of residuals\")\n```\n\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/dj6-1.pdf)\n:::\n:::\n\n\n## Facebook closing stock price\n\\fontsize{11}{11}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/dj7_baa8b2795b9455e0ed3d60496c8977b4'}\n\n```{.r .cell-code}\naugment(fit) |>\n  ACF(.resid) |>\n  autoplot() + labs(title = \"ACF of residuals\")\n```\n\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/dj7-1.pdf)\n:::\n:::\n\n\n## ACF of residuals\n\n  * We assume that the residuals are white noise (uncorrelated, mean zero, constant variance). If they aren't, then there is information left in  the residuals that should be used in computing forecasts.\n\n  * So a standard residual diagnostic is to check the ACF of the residuals of a forecasting method.\n\n  * We *expect* these to look like white noise.\n\n## Combined diagnostic graph\n\\fontsize{11}{11}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/dj8_cf49cf8484befbfdc407459c2ed4e77d'}\n\n```{.r .cell-code}\nfit |> gg_tsresiduals()\n```\n\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/dj8-1.pdf)\n:::\n:::\n\n\n## Ljung-Box test\n\\fontsize{13}{15}\\sf\n\nTest whether *whole set* of $r_{k}$ values is significantly different from zero set.\n\n\\begin{block}{}\n\\centerline{$\\displaystyle\n Q = T(T+2) \\sum_{k=1}^h (T-k)^{-1}r_k^2$\\qquad\nwhere $h=$ max lag and $T=$ \\# observations.}\n\\end{block}\n\n  * If each $r_k$ close to zero, $Q$ will be **small**.\n  * If some $r_k$ values large ($+$ or $-$), $Q$ will be **large**.\n  * My preferences: $h=10$ for non-seasonal data, $h=2m$ for seasonal data.\n  * If data are WN, $Q \\sim \\chi^2$ with $(h - K)$ degrees of freedom where $K=$ no.\\ parameters in model.\n  * When applied to raw data, set $K=0$.\n\n## Ljung-Box test\n\\fontsize{12}{13}\\sf\n\n\\begin{block}{}\n\\centerline{$\\displaystyle\n Q = T(T+2) \\sum_{k=1}^h (T-k)^{-1}r_k^2$\\qquad\nwhere $h=$ max lag and $T=$ \\# observations.}\n\\end{block}\n\n\\fontsize{11}{11}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/dj9extra_cb6561a931885ec215121644a6a0f6cf'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/dj9extra-1.pdf)\n:::\n:::\n\n\n\\vspace*{-0.3cm}\n\n\n::: {.cell hash='6-fable_cache/beamer/dj9_075812cba3ace00db7134d0b8bcdea75'}\n\n```{.r .cell-code}\n# lag=h and dof=K\naugment(fit) |> features(.resid, ljung_box, dof = 0, lag = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 x 4\n  Symbol .model       lb_stat lb_pvalue\n  <chr>  <chr>          <dbl>     <dbl>\n1 FB     NAIVE(Close)    12.1     0.276\n```\n:::\n:::\n\n\n# Lab Session 12\n## Lab Session 12\n\n  * Compute seasonal naïve forecasts for quarterly Australian beer production.\n\n  * Test if the residuals are white noise. What do you conclude?\n\n# Forecast accuracy measures\n\n## Training and test sets\n\n\n::: {.cell hash='6-fable_cache/beamer/traintest_8aaa1321306bea025993a6bddbbadef2'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/traintest-1.pdf)\n:::\n:::\n\n\n  * A model which fits the training data well will not necessarily forecast well.\n  * Forecast accuracy is based only on the test set.\n\n### Forecast errors\n\nForecast \"error\": the difference between an observed value and its forecast.\n$$\n  e_{T+h} = y_{T+h} - \\hat{y}_{T+h|T},\n$$\nwhere the training data is given by $\\{y_1,\\dots,y_T\\}$\n\n## Measures of forecast accuracy\n\\fontsize{11}{12}\\sf\n\n```r\nbeer_fit <- aus_production |>\n  filter(between(year(Quarter), 1992, 2007)) |>\n  model(\n    snaive = SNAIVE(Beer),\n    mean = MEAN(Beer)\n  )\nbeer_fit |>\n  forecast(h = \"3 years\") |>\n  autoplot(aus_production, level = NULL) +\n  labs(title =\"Forecasts for quarterly beer production\",\n       x =\"Year\", y =\"Megalitres\") +\n  guides(colour = guide_legend(title = \"Forecast\"))\n```\n\n## Measures of forecast accuracy\n\n\n::: {.cell hash='6-fable_cache/beamer/beer-fc-1_2a02ac26a1ce4c0c8afa846bebf6d768'}\n::: {.cell-output-display}\n![](6-fable_files/figure-beamer/beer-fc-1-1.pdf)\n:::\n:::\n\n\n## Measures of forecast accuracy\n\n\\begin{tabular}{rl}\n$y_{T+h}=$ & $(T+h)$th observation, $h=1,\\dots,H$ \\\\\n$\\pred{y}{T+h}{T}=$ & its forecast based on data up to time $T$. \\\\\n$e_{T+h} =$  & $y_{T+h} - \\pred{y}{T+h}{T}$\n\\end{tabular}\n\n\\begin{align*}\n\\text{MAE} &= \\text{mean}(|e_{T+h}|) \\\\[-0.2cm]\n\\text{MSE} &= \\text{mean}(e_{T+h}^2) \\qquad\n&&\\text{RMSE} &= \\sqrt{\\text{mean}(e_{T+h}^2)} \\\\[-0.1cm]\n\\text{MAPE} &= 100\\text{mean}(|e_{T+h}|/ |y_{T+h}|)\n\\end{align*}\\pause\\vspace*{-0.4cm}\n\n  * MAE, MSE, RMSE are all scale dependent.\n  * MAPE is scale independent but is only sensible if $y_t\\gg 0$ for all $t$, and $y$ has a natural zero.\n\n## Measures of forecast accuracy\n\n\\begin{block}{Mean Absolute Scaled Error}\n$$\n\\text{MASE} = \\text{mean}(|e_{T+h}|/Q)\n$$\nwhere $Q$ is a stable measure of the scale of the time series $\\{y_t\\}$.\n\\end{block}\nProposed by Hyndman and Koehler (IJF, 2006).\n\nFor non-seasonal time series,\n$$\n  Q = (T-1)^{-1}\\sum_{t=2}^T |y_t-y_{t-1}|\n$$\nworks well. Then MASE is equivalent to MAE relative to a naïve method.\n\n\\vspace*{10cm}\n\n## Measures of forecast accuracy\n\n\\begin{block}{Mean Absolute Scaled Error}\n$$\n\\text{MASE} = \\text{mean}(|e_{T+h}|/Q)\n$$\nwhere $Q$ is a stable measure of the scale of the time series $\\{y_t\\}$.\n\\end{block}\nProposed by Hyndman and Koehler (IJF, 2006).\n\nFor seasonal time series,\n$$\n  Q = (T-m)^{-1}\\sum_{t=m+1}^T |y_t-y_{t-m}|\n$$\nworks well. Then MASE is equivalent to MAE relative to a seasonal naïve method.\n\n\\vspace*{10cm}\n\n## Measures of forecast accuracy\n\n\\fontsize{9.8}{10}\\sf\n\n\n::: {.cell hash='6-fable_cache/beamer/beer-test-accuracy_e8722f9b73414f81b4def4042e66b052'}\n\n```{.r .cell-code}\nbeer_fc <- forecast(beer_fit, h = \"3 years\")\naccuracy(beer_fc, aus_production)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 10\n  .model .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1\n  <chr>  <chr> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>   <dbl>\n1 mean   Test  -13.8  38.4  34.8 -3.97  8.28 2.20  1.96  -0.0691\n2 snaive Test    5.2  14.3  13.4  1.15  3.17 0.847 0.729  0.132 \n```\n:::\n:::\n\n\n# Lab Session 13\n## Lab Session 13\n\n * Create a training set for household wealth (`hh_budget`) by witholding the last four years as a test set.\n * Fit all the appropriate benchmark methods to the training set and forecast the periods covered by the test set.\n * Compute the accuracy of your forecasts. Which method does best?\n * Repeat the exercise using the Australian takeaway food turnover data (`aus_retail`) with a test set of four years.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}